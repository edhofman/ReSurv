<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A Machine Learning Approach Based On Survival Analysis For IBNR Frequencies In Non-Life Reserving â€¢ ReSurv</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="A Machine Learning Approach Based On Survival Analysis For IBNR Frequencies In Non-Life Reserving">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ReSurv</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/cas_call.html">Claim Counts Prediction Using Individual Data</a>
    </li>
    <li>
      <a href="../articles/hp_tuning.html">Hyperparameters Tuning</a>
    </li>
    <li>
      <a href="../articles/Manuscript_replication_material.html">A Machine Learning Approach Based On Survival Analysis For IBNR Frequencies In Non-Life Reserving</a>
    </li>
    <li>
      <a href="../articles/simulate_individual_data.html">Simulate Individual Data</a>
    </li>
    <li>
      <a href="../articles/variables_importance.html">Exploring The Variables Importance</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/edhofman/ReSurv/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>A Machine Learning Approach Based On Survival
Analysis For IBNR Frequencies In Non-Life Reserving</h1>
                        <h4 data-toc-skip class="author">Gabriele
Pittarello, Emil Hofman</h4>
            
            <h4 data-toc-skip class="date">2024-11-14</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/edhofman/ReSurv/blob/HEAD/vignettes/Manuscript_replication_material.Rmd" class="external-link"><code>vignettes/Manuscript_replication_material.Rmd</code></a></small>
      <div class="hidden name"><code>Manuscript_replication_material.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In this vignette, we provide the supplementary material to replicate
the results of the manuscript <strong>A machine learning approach based
on survival analysis for IBNR frequencies in non-life
reserving</strong>.</p>
<p>We remark that the real data that we used to obtain the results that
we included in the manuscript are private and will not be shared.</p>
<p>With reference to the code related to the simulation case study, we
wanted to make this vignette quickly reproducible and drop extensive
computations. The full code that we implemented can be found at the
GitHub repository <a href="https://github.com/gpitt71/resurv-replication-code" class="external-link">resurv-replication-code</a>.</p>
<p>For optimising the hyperparameters included in this vignette, we used
the procedure shown in the <a href="https://github.com/gpitt71/ReSurv/blob/main/vignettes/hp_tuning.Rmd" class="external-link">Hyperparameters
Tuning Vignette</a> .</p>
<div class="section level3">
<h3 id="load-the-pacakge">Load the pacakge<a class="anchor" aria-label="anchor" href="#load-the-pacakge"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/edhofman/ReSurv" class="external-link">ReSurv</a></span><span class="op">)</span></span>
<span><span class="fu">reticulate</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/reticulate/reference/use_python.html" class="external-link">use_virtualenv</a></span><span class="op">(</span><span class="st">"pyresurv"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="figure-1">Figure 1<a class="anchor" aria-label="anchor" href="#figure-1"></a>
</h2>
<p>We first fit simulate and pre-process some data from Scenario
Delta.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">input_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/data_generator.html">data_generator</a></span><span class="op">(</span>random_seed <span class="op">=</span> <span class="fl">7</span>,</span>
<span>                             scenario <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                             time_unit <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">360</span>,</span>
<span>                             years <span class="op">=</span> <span class="fl">4</span>,</span>
<span>                             period_exposure <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">individual_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/IndividualDataPP.html">IndividualDataPP</a></span><span class="op">(</span><span class="va">input_data</span>,</span>
<span>                                    id <span class="op">=</span> <span class="st">"claim_number"</span>,</span>
<span>                                    continuous_features <span class="op">=</span> <span class="st">"AP_i"</span>,</span>
<span>                                    categorical_features <span class="op">=</span> <span class="st">"claim_type"</span>,</span>
<span>                                    accident_period <span class="op">=</span> <span class="st">"AP"</span>,</span>
<span>                                    calendar_period <span class="op">=</span> <span class="st">"RP"</span>,</span>
<span>                                    input_time_granularity <span class="op">=</span> <span class="st">"days"</span>,</span>
<span>                                    output_time_granularity <span class="op">=</span> <span class="st">"quarters"</span>,</span>
<span>                                    years <span class="op">=</span> <span class="fl">4</span>,</span>
<span>                                    continuous_features_spline <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                                    calendar_period_extrapolation <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>We fit a XGB model with optimal hyperparameters.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hparameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>booster <span class="op">=</span> <span class="st">"gbtree"</span>,</span>
<span>                                  eta <span class="op">=</span> <span class="fl">0.2234094</span>,</span>
<span>                                  subsample <span class="op">=</span> <span class="fl">0.8916594</span>,</span>
<span>                                  alpha <span class="op">=</span> <span class="fl">12.44775</span>,</span>
<span>                                  lambda <span class="op">=</span> <span class="fl">5.714286</span>,</span>
<span>                                  min_child_weight <span class="op">=</span> <span class="fl">4.211996</span>,</span>
<span>                                  max_depth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>                    print_every_n <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                    nrounds <span class="op">=</span> <span class="fl">3000</span>,</span>
<span>                    verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                    early_stopping_rounds <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">resurv_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ReSurv.html">ReSurv</a></span><span class="op">(</span><span class="va">individual_data</span>,</span>
<span>                     hazard_model <span class="op">=</span> <span class="st">"XGB"</span>,</span>
<span>                     hparameters <span class="op">=</span> <span class="va">hparameters</span><span class="op">)</span></span></code></pre></div>
<p>We predict for different time granularities.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">resurv_fit_predict_q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">resurv_fit</span>,</span>
<span>                                grouping_method <span class="op">=</span> <span class="st">"probability"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">individual_data_y</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/IndividualDataPP.html">IndividualDataPP</a></span><span class="op">(</span><span class="va">input_data</span>,</span>
<span>                                      id <span class="op">=</span> <span class="st">"claim_number"</span>,</span>
<span>                                      continuous_features <span class="op">=</span> <span class="st">"AP_i"</span>,</span>
<span>                                      categorical_features <span class="op">=</span> <span class="st">"claim_type"</span>,</span>
<span>                                      accident_period <span class="op">=</span> <span class="st">"AP"</span>,</span>
<span>                                      calendar_period <span class="op">=</span> <span class="st">"RP"</span>,</span>
<span>                                      input_time_granularity <span class="op">=</span> <span class="st">"days"</span>,</span>
<span>                                      output_time_granularity <span class="op">=</span> <span class="st">"years"</span>,</span>
<span>                                      years <span class="op">=</span> <span class="fl">4</span>,</span>
<span>                                      continuous_features_spline <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                                      calendar_period_extrapolation <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">resurv_fit_predict_y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">resurv_fit</span>,</span>
<span>                                newdata <span class="op">=</span> <span class="va">individual_data_y</span>,</span>
<span>                                grouping_method <span class="op">=</span> <span class="st">"probability"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">individual_data_m</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/IndividualDataPP.html">IndividualDataPP</a></span><span class="op">(</span><span class="va">input_data</span>,</span>
<span>                                      id <span class="op">=</span> <span class="st">"claim_number"</span>,</span>
<span>                                      continuous_features <span class="op">=</span> <span class="st">"AP_i"</span>,</span>
<span>                                      categorical_features <span class="op">=</span> <span class="st">"claim_type"</span>,</span>
<span>                                      accident_period <span class="op">=</span> <span class="st">"AP"</span>,</span>
<span>                                      calendar_period <span class="op">=</span> <span class="st">"RP"</span>,</span>
<span>                                      input_time_granularity <span class="op">=</span> <span class="st">"days"</span>,</span>
<span>                                      output_time_granularity <span class="op">=</span> <span class="st">"months"</span>,</span>
<span>                                      years <span class="op">=</span> <span class="fl">4</span>,</span>
<span>                                      continuous_features_spline <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                                      calendar_period_extrapolation <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">resurv_fit_predict_m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">resurv_fit</span>,</span>
<span>                                newdata <span class="op">=</span> <span class="va">individual_data_m</span>,</span>
<span>                                grouping_method <span class="op">=</span> <span class="st">"probability"</span><span class="op">)</span></span></code></pre></div>
<p>We also plot the Chain-Ladder (CL) development factors for Monthly
and Quarterly granularities</p>
<div class="section level3">
<h3 id="chain-ladder-monthly---figure-1a">Chain-Ladder (Monthly) - Figure 1a<a class="anchor" aria-label="anchor" href="#chain-ladder-monthly---figure-1a"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ticks_at</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">48</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">labels_as</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">ticks_at</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">cl_months</span> <span class="op">&lt;-</span> <span class="va">individual_data_m</span><span class="op">$</span><span class="va">training.data</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>DP_o <span class="op">=</span> <span class="fl">48</span> <span class="op">-</span> <span class="va">DP_rev_o</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">AP_o</span>, <span class="va">DP_o</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarize</span><span class="op">(</span>I <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">I</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">AP_o</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="va">DP_o</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>I_cum <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">I</span><span class="op">)</span>, I_cum_lag <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">I_cum</span>, default <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">DP_o</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">reframe</span><span class="op">(</span>df_o <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">I_cum</span> <span class="op">*</span> <span class="op">(</span></span>
<span>    <span class="va">AP_o</span> <span class="op">&lt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">individual_data_m</span><span class="op">$</span><span class="va">training.data</span><span class="op">$</span><span class="va">AP_o</span><span class="op">)</span> <span class="op">-</span> <span class="va">DP_o</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">/</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">I_cum_lag</span> <span class="op">*</span> <span class="op">(</span></span>
<span>      <span class="va">AP_o</span> <span class="op">&lt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">individual_data_m</span><span class="op">$</span><span class="va">training.data</span><span class="op">$</span><span class="va">AP_o</span><span class="op">)</span> <span class="op">-</span> <span class="va">DP_o</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>    <span class="op">)</span><span class="op">)</span>,</span>
<span>  I <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">I</span> <span class="op">*</span> <span class="op">(</span></span>
<span>    <span class="va">AP_o</span> <span class="op">&lt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">individual_data_m</span><span class="op">$</span><span class="va">training.data</span><span class="op">$</span><span class="va">AP_o</span><span class="op">)</span> <span class="op">-</span> <span class="va">DP_o</span></span>
<span>  <span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>DP_o_join <span class="op">=</span> <span class="va">DP_o</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">cl_months</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">DP_o</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">DP_o</span>,</span>
<span>             y <span class="op">=</span> <span class="va">df_o</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">2.5</span>, color <span class="op">=</span> <span class="st">"#454555"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Chain ladder"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Development month"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Development factor"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2.5</span> <span class="op">+</span> <span class="fl">.01</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="va">ticks_at</span>,</span>
<span>                     labels <span class="op">=</span> <span class="va">labels_as</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">rel</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="chain-ladder-quarterly---figure-1b">Chain-Ladder (Quarterly) - Figure 1b<a class="anchor" aria-label="anchor" href="#chain-ladder-quarterly---figure-1b"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cl_years</span> <span class="op">&lt;-</span> <span class="va">resurv_fit</span><span class="op">$</span><span class="va">IndividualDataPP</span><span class="op">$</span><span class="va">training.data</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>DP_o <span class="op">=</span> <span class="fl">16</span> <span class="op">-</span> <span class="va">DP_rev_o</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">AP_o</span>, <span class="va">DP_o</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarize</span><span class="op">(</span>I <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">I</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">AP_o</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="va">DP_o</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>I_cum <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">I</span><span class="op">)</span>, I_cum_lag <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">I_cum</span>, default <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">DP_o</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">reframe</span><span class="op">(</span>df_o <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">I_cum</span> <span class="op">*</span> <span class="op">(</span></span>
<span>    <span class="va">AP_o</span> <span class="op">&lt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">resurv_fit</span><span class="op">$</span><span class="va">IndividualDataPP</span><span class="op">$</span><span class="va">training.data</span><span class="op">$</span><span class="va">AP_o</span><span class="op">)</span> <span class="op">-</span> <span class="va">DP_o</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">/</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">I_cum_lag</span> <span class="op">*</span> <span class="op">(</span></span>
<span>      <span class="va">AP_o</span> <span class="op">&lt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">resurv_fit</span><span class="op">$</span><span class="va">IndividualDataPP</span><span class="op">$</span><span class="va">training.data</span><span class="op">$</span><span class="va">AP_o</span><span class="op">)</span> <span class="op">-</span> <span class="va">DP_o</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>    <span class="op">)</span><span class="op">)</span>,</span>
<span>  I <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">I</span> <span class="op">*</span> <span class="op">(</span></span>
<span>    <span class="va">AP_o</span> <span class="op">&lt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">resurv_fit</span><span class="op">$</span><span class="va">IndividualDataPP</span><span class="op">$</span><span class="va">training.data</span><span class="op">$</span><span class="va">AP_o</span><span class="op">)</span> <span class="op">-</span> <span class="va">DP_o</span></span>
<span>  <span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>DP_o_join <span class="op">=</span> <span class="va">DP_o</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cl_years</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">DP_o</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">DP_o</span>, y <span class="op">=</span> <span class="va">df_o</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">2.5</span>, color <span class="op">=</span> <span class="st">"#454555"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Chain ladder"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Development quarter"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Development factor"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span> <span class="op">+</span> <span class="fl">.01</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">rel</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ticks_at</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">16</span>, by <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">labels_as</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">ticks_at</span><span class="op">)</span></span></code></pre></div>
<p>For different granularities and feature combinations we plot the XGB
feature dependent development factors. ` ## XGB (Quarterly) - Figure
1f</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ap</span> <span class="op">&lt;-</span> <span class="fl">15</span></span>
<span><span class="va">ct</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">resurv_fit_predict_q</span><span class="op">$</span><span class="va">long_triangle_format_out</span><span class="op">$</span><span class="va">output_granularity</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">AP_o</span> <span class="op">==</span> <span class="fl">15</span> <span class="op">&amp;</span> <span class="va">claim_type</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu">row_number</span><span class="op">(</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">group_o</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">resurv_fit_predict_q</span>,</span>
<span>  granularity <span class="op">=</span> <span class="st">"output"</span>,</span>
<span>  title_par <span class="op">=</span> <span class="st">"XGB: Accident Quarter 15 Claim Type 1"</span>,</span>
<span>  x_text_par <span class="op">=</span> <span class="st">"Development Quarter"</span>,</span>
<span>  group_code <span class="op">=</span> <span class="fl">30</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="xgb-quarterly---figure-1g">XGB (Quarterly) - Figure 1g<a class="anchor" aria-label="anchor" href="#xgb-quarterly---figure-1g"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ct</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">ap</span> <span class="op">&lt;-</span> <span class="fl">15</span></span>
<span></span>
<span><span class="va">resurv_fit_predict_q</span><span class="op">$</span><span class="va">long_triangle_format_out</span><span class="op">$</span><span class="va">output_granularity</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">AP_o</span> <span class="op">==</span> <span class="va">ap</span> <span class="op">&amp;</span> <span class="va">claim_type</span> <span class="op">==</span> <span class="va">ct</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu">row_number</span><span class="op">(</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">group_o</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">resurv_fit_predict_q</span>,</span>
<span>  granularity <span class="op">=</span> <span class="st">"output"</span>,</span>
<span>  title_par <span class="op">=</span> <span class="st">"XGB: Accident Quarter 15 Claim Type 0"</span>,</span>
<span>  x_text_par <span class="op">=</span> <span class="st">"Development Quarter"</span>,</span>
<span>  ylim_par <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  group_code <span class="op">=</span> <span class="fl">29</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="xgb-quarterly---figure-1h">XGB (Quarterly) - Figure 1h<a class="anchor" aria-label="anchor" href="#xgb-quarterly---figure-1h"></a>
</h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ct</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">ap</span> <span class="op">&lt;-</span> <span class="fl">16</span></span>
<span></span>
<span><span class="va">resurv_fit_predict_q</span><span class="op">$</span><span class="va">long_triangle_format_out</span><span class="op">$</span><span class="va">output_granularity</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">AP_o</span> <span class="op">==</span> <span class="va">ap</span> <span class="op">&amp;</span> <span class="va">claim_type</span> <span class="op">==</span> <span class="va">ct</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu">row_number</span><span class="op">(</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">group_o</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">resurv_fit_predict_q</span>,</span>
<span>  granularity <span class="op">=</span> <span class="st">"output"</span>,</span>
<span>  title_par <span class="op">=</span> <span class="st">"XGB: Accident Quarter 16 Claim Type 0"</span>,</span>
<span>  x_text_par <span class="op">=</span> <span class="st">"Development Quarter"</span>,</span>
<span>  ylim_par <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  group_code <span class="op">=</span> <span class="fl">31</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="xgb-monthly---figure-1c">XGB (Monthly) - Figure 1c<a class="anchor" aria-label="anchor" href="#xgb-monthly---figure-1c"></a>
</h3>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ct</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">ap</span> <span class="op">&lt;-</span> <span class="fl">7</span></span>
<span></span>
<span><span class="va">resurv_fit_predict_m</span><span class="op">$</span><span class="va">long_triangle_format_out</span><span class="op">$</span><span class="va">output_granularity</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">AP_o</span> <span class="op">==</span> <span class="va">ap</span> <span class="op">&amp;</span> <span class="va">claim_type</span> <span class="op">==</span> <span class="va">ct</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu">row_number</span><span class="op">(</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">group_o</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">resurv_fit_predict_m</span>,</span>
<span>  granularity <span class="op">=</span> <span class="st">"output"</span>,</span>
<span>  title_par <span class="op">=</span> <span class="st">"XGB: Accident Month 7 Claim Type 1"</span>,</span>
<span>  x_text_par <span class="op">=</span> <span class="st">"Development Month"</span>,</span>
<span>  color_par <span class="op">=</span> <span class="st">"#a71429"</span>,</span>
<span>  ylim_par <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  group_code <span class="op">=</span> <span class="fl">14</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="xgb-monthly---figure-1d">XGB (Monthly) - Figure 1d<a class="anchor" aria-label="anchor" href="#xgb-monthly---figure-1d"></a>
</h3>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ct</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">ap</span> <span class="op">&lt;-</span> <span class="fl">9</span></span>
<span></span>
<span><span class="va">resurv_fit_predict_m</span><span class="op">$</span><span class="va">long_triangle_format_out</span><span class="op">$</span><span class="va">output_granularity</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">AP_o</span> <span class="op">==</span> <span class="va">ap</span> <span class="op">&amp;</span> <span class="va">claim_type</span> <span class="op">==</span> <span class="va">ct</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu">row_number</span><span class="op">(</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">group_o</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">resurv_fit_predict_m</span>,</span>
<span>  granularity <span class="op">=</span> <span class="st">"output"</span>,</span>
<span>  title_par <span class="op">=</span> <span class="st">"XGB: Accident Month 9 Claim Type 0"</span>,</span>
<span>  x_text_par <span class="op">=</span> <span class="st">"Development Month"</span>,</span>
<span>  color_par <span class="op">=</span> <span class="st">"#a71429"</span>,</span>
<span>  ylim_par <span class="op">=</span> <span class="fl">2.5</span>,</span>
<span>  group_code <span class="op">=</span> <span class="fl">17</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="xgb-monthly---figure-1e">XGB (Monthly) - Figure 1e<a class="anchor" aria-label="anchor" href="#xgb-monthly---figure-1e"></a>
</h3>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ct</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">ap</span> <span class="op">&lt;-</span> <span class="fl">36</span></span>
<span></span>
<span></span>
<span><span class="va">resurv_fit_predict_m</span><span class="op">$</span><span class="va">long_triangle_format_out</span><span class="op">$</span><span class="va">output_granularity</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">AP_o</span> <span class="op">==</span> <span class="va">ap</span> <span class="op">&amp;</span> <span class="va">claim_type</span> <span class="op">==</span> <span class="va">ct</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu">row_number</span><span class="op">(</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">group_o</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">resurv_fit_predict_m</span>,</span>
<span>  granularity <span class="op">=</span> <span class="st">"output"</span>,</span>
<span>  title_par <span class="op">=</span> <span class="st">"XGB: Accident Month 36 Claim Type 0"</span>,</span>
<span>  color_par <span class="op">=</span> <span class="st">"#a71429"</span>,</span>
<span>  x_text_par <span class="op">=</span> <span class="st">"Development Month"</span>,</span>
<span>  ylim_par <span class="op">=</span> <span class="fl">2.5</span>,</span>
<span>  group_code <span class="op">=</span> <span class="fl">71</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="table-2">Table 2<a class="anchor" aria-label="anchor" href="#table-2"></a>
</h2>
<p>The models likelihood can be extracted using the following commands.
Table 2 shows the average negative log-likelihood for each scenario over
the different simulations, here we show the results for XGB, scenario
Delta and simulation number 7.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">resurv_fit</span><span class="op">$</span><span class="va">is_lkh</span></span>
<span></span>
<span><span class="va">resurv_fit</span><span class="op">$</span><span class="va">os_lkh</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="fitted-survival-curve---figure-4-and-figure-5">Fitted Survival Curve - Figure 4 and Figure 5<a class="anchor" aria-label="anchor" href="#fitted-survival-curve---figure-4-and-figure-5"></a>
</h2>
<p>We show how to plot the fitted survival function for scenario Alpha
and scenario Delta against the true survival function.</p>
<div class="section level3">
<h3 id="figure-4">Figure 4<a class="anchor" aria-label="anchor" href="#figure-4"></a>
</h3>
<p>We find the true Survival Function for scenario Alpha, claim type
1.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">*</span> <span class="fl">30</span></span>
<span><span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fl">0.1</span></span>
<span><span class="va">k</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fl">1440</span></span>
<span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span>
<span><span class="va">beta0</span> <span class="op">&lt;-</span> <span class="fl">1.15129</span></span>
<span><span class="va">beta1</span> <span class="op">&lt;-</span> <span class="fl">1.95601</span></span>
<span></span>
<span><span class="va">f_correct_s0</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">alpha</span>, <span class="va">beta</span>, <span class="va">lambda</span>, <span class="va">k</span>, <span class="va">b</span>, <span class="va">beta_coef</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="va">inner</span> <span class="op">&lt;-</span> <span class="va">lambda</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">beta_coef</span><span class="op">)</span> <span class="op">^</span> <span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="va">alpha</span> <span class="op">*</span> <span class="va">k</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">element_one</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="va">beta</span> <span class="op">^</span> <span class="va">alpha</span> <span class="op">*</span> <span class="op">(</span><span class="va">inner</span><span class="op">)</span> <span class="op">^</span> <span class="op">(</span><span class="va">alpha</span> <span class="op">*</span> <span class="va">k</span><span class="op">)</span></span>
<span>  <span class="va">element_two</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">t</span> <span class="op">^</span> <span class="op">(</span><span class="op">-</span><span class="va">alpha</span> <span class="op">*</span> <span class="va">k</span><span class="op">)</span> <span class="op">-</span> <span class="va">b</span> <span class="op">^</span> <span class="op">(</span><span class="op">-</span><span class="va">alpha</span> <span class="op">*</span> <span class="va">k</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">element_one</span> <span class="op">*</span> <span class="va">element_two</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">c_correct_grouped</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="va">b</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">i</span>, <span class="va">i</span> <span class="op">+</span> <span class="fl">1</span>, by <span class="op">=</span> <span class="fl">0.001</span><span class="op">)</span></span>
<span>  <span class="va">n_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span></span>
<span>  <span class="va">calculation</span> <span class="op">&lt;-</span> <span class="fu">f_correct_s0</span><span class="op">(</span><span class="va">t</span>, <span class="va">alpha</span>, <span class="va">beta</span>, <span class="va">lambda</span>, <span class="va">k</span>, <span class="va">b</span>, <span class="va">beta0</span><span class="op">)</span></span>
<span>  <span class="va">c_correct_grouped</span><span class="op">[</span><span class="va">i</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">calculation</span><span class="op">)</span> <span class="op">/</span></span>
<span>    <span class="va">n_t</span></span>
<span><span class="op">}</span></span>
<span><span class="va">c_correct_grouped</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">c_correct_grouped</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">b</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">c_correct_grouped1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="va">b</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">i</span>, <span class="va">i</span> <span class="op">+</span> <span class="fl">1</span>, by <span class="op">=</span> <span class="fl">0.001</span><span class="op">)</span></span>
<span>  <span class="va">n_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span></span>
<span>  <span class="va">calculation</span> <span class="op">&lt;-</span> <span class="fu">f_correct_s0</span><span class="op">(</span><span class="va">t</span>, <span class="va">alpha</span>, <span class="va">beta</span>, <span class="va">lambda</span>, <span class="va">k</span>, <span class="va">b</span>, <span class="va">beta1</span><span class="op">)</span></span>
<span>  <span class="va">c_correct_grouped1</span><span class="op">[</span><span class="va">i</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">calculation</span><span class="op">)</span> <span class="op">/</span></span>
<span>    <span class="va">n_t</span></span>
<span><span class="op">}</span></span>
<span><span class="va">c_correct_grouped1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">c_correct_grouped1</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">b</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">true_curve</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/data.table.html" class="external-link">data.table</a></span><span class="op">(</span></span>
<span>  <span class="st">"DP_rev_i"</span> <span class="op">=</span> <span class="op">(</span><span class="va">b</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="op">(</span><span class="va">b</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>, by <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  <span class="st">"S_i"</span> <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="op">(</span><span class="va">c_correct_grouped1</span><span class="op">)</span>,</span>
<span>  <span class="st">"model_label"</span> <span class="op">=</span> <span class="st">"TRUE"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We generate the data for Scenario Alpha.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">input_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/data_generator.html">data_generator</a></span><span class="op">(</span></span>
<span>  random_seed <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  scenario <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  time_unit <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">360</span>,</span>
<span>  years <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  period_exposure <span class="op">=</span> <span class="fl">200</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">individual_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/IndividualDataPP.html">IndividualDataPP</a></span><span class="op">(</span></span>
<span>  <span class="va">input_data</span>,</span>
<span>  id <span class="op">=</span> <span class="st">"claim_number"</span>,</span>
<span>  continuous_features <span class="op">=</span> <span class="st">"AP_i"</span>,</span>
<span>  categorical_features <span class="op">=</span> <span class="st">"claim_type"</span>,</span>
<span>  accident_period <span class="op">=</span> <span class="st">"AP"</span>,</span>
<span>  calendar_period <span class="op">=</span> <span class="st">"RP"</span>,</span>
<span>  input_time_granularity <span class="op">=</span> <span class="st">"days"</span>,</span>
<span>  output_time_granularity <span class="op">=</span> <span class="st">"quarters"</span>,</span>
<span>  years <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  continuous_features_spline <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  calendar_period_extrapolation <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Here the optimal hyperparameters for XGB and NN for the generated
data set.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hparameters_xgb_01</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    booster <span class="op">=</span> <span class="st">"gbtree"</span>,</span>
<span>    eta <span class="op">=</span> <span class="fl">0.9887265</span>,</span>
<span>    subsample <span class="op">=</span> <span class="fl">0.7924135</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">10.85342</span>,</span>
<span>    lambda <span class="op">=</span> <span class="fl">6.213317</span>,</span>
<span>    min_child_weight <span class="op">=</span> <span class="fl">3.042204</span>,</span>
<span>    max_depth <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span>,</span>
<span>  print_every_n <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  nrounds <span class="op">=</span> <span class="fl">3000</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  early_stopping_rounds <span class="op">=</span> <span class="fl">500</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">hparameters_nn_01</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  num_layers <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  early_stopping <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  patience <span class="op">=</span> <span class="fl">350</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  network_structure <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  num_nodes <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  activation <span class="op">=</span> <span class="st">"SELU"</span>,</span>
<span>  optim <span class="op">=</span> <span class="st">"SGD"</span>,</span>
<span>  lr <span class="op">=</span> <span class="fl">0.2741031</span>,</span>
<span>  xi <span class="op">=</span> <span class="fl">0.3829451</span>,</span>
<span>  epsilon <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  batch_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fl">5000</span><span class="op">)</span>,</span>
<span>  epochs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fl">5500</span><span class="op">)</span>,</span>
<span>  num_workers <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  tie <span class="op">=</span> <span class="st">"Efron"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We fit COX, NN and XGB on the simulated data.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">resurv_fit_cox_01</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ReSurv.html">ReSurv</a></span><span class="op">(</span><span class="va">individual_data</span>,</span>
<span>                             hazard_model <span class="op">=</span> <span class="st">"COX"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">resurv_fit_nn_01</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ReSurv.html">ReSurv</a></span><span class="op">(</span><span class="va">individual_data</span>,</span>
<span>                             hazard_model <span class="op">=</span> <span class="st">"NN"</span>,</span>
<span>                             hparameters <span class="op">=</span> <span class="va">hparameters_nn_01</span><span class="op">)</span></span>
<span></span>
<span><span class="va">resurv_fit_xgb_01</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ReSurv.html">ReSurv</a></span><span class="op">(</span><span class="va">individual_data</span>,</span>
<span>                             hazard_model <span class="op">=</span> <span class="st">"XGB"</span>,</span>
<span>                             hparameters <span class="op">=</span> <span class="va">hparameters_xgb_01</span><span class="op">)</span></span></code></pre></div>
<p>Extract the fitted survival curve.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hazard_frame_updated_cox</span> <span class="op">&lt;-</span> <span class="va">resurv_fit_cox_01</span><span class="op">$</span><span class="va">hazard_frame</span></span>
<span></span>
<span><span class="va">hazard_frame_updated_nn</span> <span class="op">&lt;-</span> <span class="va">resurv_fit_nn_01</span><span class="op">$</span><span class="va">hazard_frame</span></span>
<span></span>
<span><span class="va">hazard_frame_updated_xgb</span> <span class="op">&lt;-</span> <span class="va">resurv_fit_xgb_01</span><span class="op">$</span><span class="va">hazard_frame</span></span>
<span></span>
<span></span>
<span><span class="va">cond_1</span> <span class="op">&lt;-</span> <span class="va">hazard_frame_updated_cox</span><span class="op">$</span><span class="va">AP_i</span> <span class="op">==</span> <span class="fl">13</span> <span class="op">&amp;</span></span>
<span>  <span class="va">hazard_frame_updated_cox</span><span class="op">$</span><span class="va">claim_type</span> <span class="op">==</span> <span class="fl">1</span></span>
<span><span class="va">estimated_cox</span> <span class="op">&lt;-</span> <span class="va">hazard_frame_updated_cox</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S_i"</span>, <span class="st">"DP_rev_i"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">estimated_cox</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">estimated_cox</span><span class="op">)</span><span class="op">[</span>, <span class="va">model_label</span> <span class="op">:=</span> <span class="st">"COX"</span><span class="op">]</span></span>
<span></span>
<span><span class="va">cond_2</span> <span class="op">&lt;-</span> <span class="va">hazard_frame_updated_nn</span><span class="op">$</span><span class="va">AP_i</span> <span class="op">==</span> <span class="fl">13</span> <span class="op">&amp;</span></span>
<span>  <span class="va">hazard_frame_updated_nn</span><span class="op">$</span><span class="va">claim_type</span> <span class="op">==</span> <span class="fl">1</span></span>
<span><span class="va">estimated_nn</span> <span class="op">&lt;-</span> <span class="va">hazard_frame_updated_nn</span><span class="op">[</span><span class="va">cond_2</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S_i"</span>, <span class="st">"DP_rev_i"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">estimated_nn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">estimated_nn</span><span class="op">)</span><span class="op">[</span>, <span class="va">model_label</span> <span class="op">:=</span> <span class="st">"NN"</span><span class="op">]</span></span>
<span></span>
<span></span>
<span><span class="va">cond_3</span> <span class="op">&lt;-</span> <span class="va">hazard_frame_updated_xgb</span><span class="op">$</span><span class="va">AP_i</span> <span class="op">==</span> <span class="fl">13</span> <span class="op">&amp;</span></span>
<span>  <span class="va">hazard_frame_updated_xgb</span><span class="op">$</span><span class="va">claim_type</span> <span class="op">==</span> <span class="fl">1</span></span>
<span><span class="va">estimated_xgb</span> <span class="op">&lt;-</span> <span class="va">hazard_frame_updated_xgb</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S_i"</span>, <span class="st">"DP_rev_i"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">estimated_xgb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">estimated_xgb</span><span class="op">)</span><span class="op">[</span><span class="va">cond3</span>, <span class="va">model_label</span> <span class="op">:=</span> <span class="st">"XGB"</span><span class="op">]</span></span>
<span></span>
<span><span class="va">dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">estimated_cox</span>, <span class="va">estimated_nn</span>, <span class="va">estimated_xgb</span><span class="op">)</span></span></code></pre></div>
<p>Plot the fitted survival curve for the three.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">dt</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">DP_rev_i</span>, y <span class="op">=</span> <span class="va">S_i</span>, color <span class="op">=</span> <span class="va">model_label</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="op">~</span> <span class="va">model_label</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"line"</span>,</span>
<span>    x <span class="op">=</span> <span class="va">true_curve</span><span class="op">$</span><span class="va">DP_rev_i</span>,</span>
<span>    y <span class="op">=</span> <span class="va">true_curve</span><span class="op">$</span><span class="va">S_i</span>,</span>
<span>    lty <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span></span>
<span>    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">440</span>, <span class="fl">940</span><span class="op">)</span>,</span>
<span>    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1440"</span>, <span class="st">"1000"</span>, <span class="st">"500"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">.001</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Development time"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Survival function"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Model"</span>,</span>
<span>                     values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#AAAABC"</span>, <span class="st">"#a71429"</span>, <span class="st">"#4169E1"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    legend.position <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>    text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>,</span>
<span>    axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span></span>
<span>      angle <span class="op">=</span> <span class="fl">90</span>,</span>
<span>      vjust <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>      hjust <span class="op">=</span> <span class="fl">1</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="figure-5">Figure 5<a class="anchor" aria-label="anchor" href="#figure-5"></a>
</h3>
<p>We find the true Survival Function for scenario Delta, accident day
691 and claim type 1.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a>my_ap <span class="ot">=</span> <span class="dv">691</span></span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>period_function <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a>  <span class="st">"</span></span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a><span class="st">  Add monthly seasonal effect starting from daily input.</span></span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a><span class="st">  "</span></span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a>  </span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a>  tmp <span class="ot">&lt;-</span> <span class="fu">floor</span>((x <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">/</span> <span class="dv">30</span>)</span>
<span id="cb20-9"><a href="#cb20-9" tabindex="-1"></a>  </span>
<span id="cb20-10"><a href="#cb20-10" tabindex="-1"></a>  <span class="cf">if</span> ((tmp <span class="sc">%%</span> <span class="dv">12</span>) <span class="sc">%in%</span> (<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>))) {</span>
<span id="cb20-11"><a href="#cb20-11" tabindex="-1"></a>    <span class="fu">return</span>(<span class="sc">-</span><span class="fl">0.3</span>)</span>
<span id="cb20-12"><a href="#cb20-12" tabindex="-1"></a>  }</span>
<span id="cb20-13"><a href="#cb20-13" tabindex="-1"></a>  <span class="cf">if</span> ((tmp <span class="sc">%%</span> <span class="dv">12</span>) <span class="sc">%in%</span> (<span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>))) {</span>
<span id="cb20-14"><a href="#cb20-14" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fl">0.4</span>)</span>
<span id="cb20-15"><a href="#cb20-15" tabindex="-1"></a>  }</span>
<span id="cb20-16"><a href="#cb20-16" tabindex="-1"></a>  <span class="cf">if</span> ((tmp <span class="sc">%%</span> <span class="dv">12</span>) <span class="sc">%in%</span> (<span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>))) {</span>
<span id="cb20-17"><a href="#cb20-17" tabindex="-1"></a>    <span class="fu">return</span>(<span class="sc">-</span><span class="fl">0.7</span>)</span>
<span id="cb20-18"><a href="#cb20-18" tabindex="-1"></a>  }</span>
<span id="cb20-19"><a href="#cb20-19" tabindex="-1"></a>  <span class="cf">if</span> ((tmp <span class="sc">%%</span> <span class="dv">12</span>) <span class="sc">%in%</span> (<span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">0</span>, <span class="dv">1</span>))) {</span>
<span id="cb20-20"><a href="#cb20-20" tabindex="-1"></a>    <span class="co">#0 instead of 12</span></span>
<span id="cb20-21"><a href="#cb20-21" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fl">0.1</span>)</span>
<span id="cb20-22"><a href="#cb20-22" tabindex="-1"></a>  }</span>
<span id="cb20-23"><a href="#cb20-23" tabindex="-1"></a>}</span>
<span id="cb20-24"><a href="#cb20-24" tabindex="-1"></a></span>
<span id="cb20-25"><a href="#cb20-25" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="dv">30</span></span>
<span id="cb20-26"><a href="#cb20-26" tabindex="-1"></a>lambda <span class="ot">&lt;-</span> <span class="fl">0.1</span></span>
<span id="cb20-27"><a href="#cb20-27" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb20-28"><a href="#cb20-28" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="dv">1440</span></span>
<span id="cb20-29"><a href="#cb20-29" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb20-30"><a href="#cb20-30" tabindex="-1"></a>beta0 <span class="ot">&lt;-</span> <span class="fl">1.15129</span></span>
<span id="cb20-31"><a href="#cb20-31" tabindex="-1"></a>beta1 <span class="ot">&lt;-</span> <span class="fl">1.95601</span> <span class="sc">+</span> <span class="fu">period_function</span>(my_ap)</span>
<span id="cb20-32"><a href="#cb20-32" tabindex="-1"></a></span>
<span id="cb20-33"><a href="#cb20-33" tabindex="-1"></a>f_correct_s0 <span class="ot">&lt;-</span> <span class="cf">function</span>(t, alpha, beta, lambda, k, b, beta_coef) {</span>
<span id="cb20-34"><a href="#cb20-34" tabindex="-1"></a>  element_1 <span class="ot">&lt;-</span> <span class="sc">-</span>beta <span class="sc">^</span> alpha</span>
<span id="cb20-35"><a href="#cb20-35" tabindex="-1"></a>  element_2 <span class="ot">&lt;-</span> lambda <span class="sc">*</span> <span class="fu">exp</span>(beta_coef) <span class="sc">^</span> (<span class="dv">1</span> <span class="sc">/</span> (alpha <span class="sc">*</span> k))</span>
<span id="cb20-36"><a href="#cb20-36" tabindex="-1"></a>  element_ <span class="dv">3</span> <span class="ot">&lt;-</span> t <span class="sc">^</span> (<span class="sc">-</span>alpha <span class="sc">*</span> k) <span class="sc">-</span> b <span class="sc">^</span> (<span class="sc">-</span>alpha <span class="sc">*</span> k)</span>
<span id="cb20-37"><a href="#cb20-37" tabindex="-1"></a>  <span class="fu">exp</span>(element_1 <span class="sc">*</span> (element_2) <span class="sc">^</span> (alpha <span class="sc">*</span> k) <span class="sc">*</span> ())</span>
<span id="cb20-38"><a href="#cb20-38" tabindex="-1"></a>}</span>
<span id="cb20-39"><a href="#cb20-39" tabindex="-1"></a></span>
<span id="cb20-40"><a href="#cb20-40" tabindex="-1"></a>c_correct_grouped <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb20-41"><a href="#cb20-41" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span>(b <span class="sc">-</span> <span class="dv">1</span>)) {</span>
<span id="cb20-42"><a href="#cb20-42" tabindex="-1"></a>  t <span class="ot">&lt;-</span> <span class="fu">seq</span>(i, i <span class="sc">+</span> <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.001</span>)</span>
<span id="cb20-43"><a href="#cb20-43" tabindex="-1"></a>  n_t <span class="ot">&lt;-</span> <span class="fu">length</span>(t)</span>
<span id="cb20-44"><a href="#cb20-44" tabindex="-1"></a>  calculation <span class="ot">&lt;-</span> <span class="fu">f_correct_s0</span>(t, alpha, beta, lambda, k, b, beta0)</span>
<span id="cb20-45"><a href="#cb20-45" tabindex="-1"></a>  c_correct_grouped[i <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="dv">1</span> <span class="sc">-</span> calculation) <span class="sc">/</span></span>
<span id="cb20-46"><a href="#cb20-46" tabindex="-1"></a>    n_t</span>
<span id="cb20-47"><a href="#cb20-47" tabindex="-1"></a>}</span>
<span id="cb20-48"><a href="#cb20-48" tabindex="-1"></a>c_correct_grouped <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, c_correct_grouped[<span class="dv">1</span><span class="sc">:</span>(b <span class="sc">-</span> <span class="dv">1</span>)])</span>
<span id="cb20-49"><a href="#cb20-49" tabindex="-1"></a></span>
<span id="cb20-50"><a href="#cb20-50" tabindex="-1"></a>c_correct_grouped1 <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb20-51"><a href="#cb20-51" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span>(b <span class="sc">-</span> <span class="dv">1</span>)) {</span>
<span id="cb20-52"><a href="#cb20-52" tabindex="-1"></a>  t <span class="ot">&lt;-</span> <span class="fu">seq</span>(i, i <span class="sc">+</span> <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.001</span>)</span>
<span id="cb20-53"><a href="#cb20-53" tabindex="-1"></a>  n_t <span class="ot">&lt;-</span> <span class="fu">length</span>(t)</span>
<span id="cb20-54"><a href="#cb20-54" tabindex="-1"></a>  calculation <span class="ot">&lt;-</span> <span class="fu">f_correct_s0</span>(t, alpha, beta, lambda, k, b, beta1)</span>
<span id="cb20-55"><a href="#cb20-55" tabindex="-1"></a>  c_correct_grouped1[i <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="dv">1</span> <span class="sc">-</span> calculation) <span class="sc">/</span> n_t</span>
<span id="cb20-56"><a href="#cb20-56" tabindex="-1"></a>}</span>
<span id="cb20-57"><a href="#cb20-57" tabindex="-1"></a>c_correct_grouped1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, c_correct_grouped1[<span class="dv">1</span><span class="sc">:</span>(b <span class="sc">-</span> <span class="dv">1</span>)])</span>
<span id="cb20-58"><a href="#cb20-58" tabindex="-1"></a></span>
<span id="cb20-59"><a href="#cb20-59" tabindex="-1"></a>true_curve <span class="ot">&lt;-</span> <span class="fu">data.table</span>(</span>
<span id="cb20-60"><a href="#cb20-60" tabindex="-1"></a>  <span class="st">"DP_rev_i"</span> <span class="ot">=</span> (b <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">-</span> <span class="fu">seq</span>(<span class="dv">0</span>, (b <span class="sc">-</span> <span class="dv">1</span>), <span class="at">by =</span> <span class="dv">1</span>),</span>
<span id="cb20-61"><a href="#cb20-61" tabindex="-1"></a>  <span class="st">"S_i"</span> <span class="ot">=</span> <span class="dv">1</span> <span class="sc">-</span> (c_correct_grouped1),</span>
<span id="cb20-62"><a href="#cb20-62" tabindex="-1"></a>  <span class="st">"model_label"</span> <span class="ot">=</span> <span class="st">"TRUE"</span></span>
<span id="cb20-63"><a href="#cb20-63" tabindex="-1"></a>)</span></code></pre></div>
<p>We generate a data set from scenario Delta.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">input_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/data_generator.html">data_generator</a></span><span class="op">(</span></span>
<span>  random_seed <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  scenario <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  time_unit <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">360</span>,</span>
<span>  years <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  period_exposure <span class="op">=</span> <span class="fl">200</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">individual_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/IndividualDataPP.html">IndividualDataPP</a></span><span class="op">(</span></span>
<span>  <span class="va">input_data</span>,</span>
<span>  id <span class="op">=</span> <span class="st">"claim_number"</span>,</span>
<span>  continuous_features <span class="op">=</span> <span class="st">"AP_i"</span>,</span>
<span>  categorical_features <span class="op">=</span> <span class="st">"claim_type"</span>,</span>
<span>  accident_period <span class="op">=</span> <span class="st">"AP"</span>,</span>
<span>  calendar_period <span class="op">=</span> <span class="st">"RP"</span>,</span>
<span>  input_time_granularity <span class="op">=</span> <span class="st">"days"</span>,</span>
<span>  output_time_granularity <span class="op">=</span> <span class="st">"quarters"</span>,</span>
<span>  years <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  continuous_features_spline <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  calendar_period_extrapolation <span class="op">=</span> <span class="cn">F</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Here the optimal parameters for the data set above for XGB and
NN.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hparameters_xgb_31</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    booster <span class="op">=</span> <span class="st">"gbtree"</span>,</span>
<span>    eta <span class="op">=</span> <span class="fl">0.1801517</span>,</span>
<span>    subsample <span class="op">=</span> <span class="fl">0.8768306</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.6620562</span>,</span>
<span>    lambda <span class="op">=</span> <span class="fl">1.379897</span>,</span>
<span>    min_child_weight <span class="op">=</span> <span class="fl">15.61339</span>,</span>
<span>    max_depth <span class="op">=</span> <span class="fl">2</span></span>
<span>  <span class="op">)</span>,</span>
<span>  print_every_n <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  nrounds <span class="op">=</span> <span class="fl">3000</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  early_stopping_rounds <span class="op">=</span> <span class="fl">500</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">hparameters_nn_31</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  num_layers <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  early_stopping <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  patience <span class="op">=</span> <span class="fl">350</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  network_structure <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  num_nodes <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  activation <span class="op">=</span> <span class="st">"LeakyReLU"</span>,</span>
<span>  optim <span class="op">=</span> <span class="st">"Adam"</span>,</span>
<span>  lr <span class="op">=</span> <span class="fl">0.3542422</span>,</span>
<span>  xi <span class="op">=</span> <span class="fl">0.1803953</span>,</span>
<span>  epsilon <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  batch_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fl">5000</span><span class="op">)</span>,</span>
<span>  epochs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fl">5500</span><span class="op">)</span>,</span>
<span>  num_workers <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  tie <span class="op">=</span> <span class="st">"Efron"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We fit COX, NN and XGB.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">resurv_fit_cox_31</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ReSurv.html">ReSurv</a></span><span class="op">(</span><span class="va">individual_data</span>, hazard_model <span class="op">=</span> <span class="st">"COX"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">resurv_fit_nn_31</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ReSurv.html">ReSurv</a></span><span class="op">(</span><span class="va">individual_data</span>,</span>
<span>                           hazard_model <span class="op">=</span> <span class="st">"NN"</span>,</span>
<span>                           hparameters <span class="op">=</span> <span class="va">hparameters_nn_31</span><span class="op">)</span></span>
<span></span>
<span><span class="va">resurv_fit_xgb_31</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ReSurv.html">ReSurv</a></span><span class="op">(</span><span class="va">individual_data</span>,</span>
<span>                            hazard_model <span class="op">=</span> <span class="st">"XGB"</span>,</span>
<span>                            hparameters <span class="op">=</span> <span class="va">hparameters_xgb_31</span><span class="op">)</span></span></code></pre></div>
<p>Extract the fitted survival curve.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hazard_frame_updated_cox</span> <span class="op">&lt;-</span> <span class="va">resurv_fit_cox_31</span><span class="op">$</span><span class="va">hazard_frame</span></span>
<span></span>
<span><span class="va">hazard_frame_updated_nn</span> <span class="op">&lt;-</span> <span class="va">resurv_fit_nn_31</span><span class="op">$</span><span class="va">hazard_frame</span></span>
<span></span>
<span><span class="va">hazard_frame_updated_xgb</span> <span class="op">&lt;-</span> <span class="va">resurv_fit_xgb_31</span><span class="op">$</span><span class="va">hazard_frame</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="va">cond_1</span> <span class="op">&lt;-</span> <span class="va">hazard_frame_updated_cox</span><span class="op">$</span><span class="va">AP_i</span> <span class="op">==</span> <span class="va">my_ap</span> <span class="op">&amp;</span></span>
<span>  <span class="va">hazard_frame_updated_cox</span><span class="op">$</span><span class="va">claim_type</span> <span class="op">==</span> <span class="fl">1</span></span>
<span></span>
<span><span class="va">estimated_cox</span> <span class="op">&lt;-</span> <span class="va">hazard_frame_updated_cox</span><span class="op">[</span><span class="va">cond_1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S_i"</span>, <span class="st">"DP_rev_i"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">estimated_cox</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">estimated_cox</span><span class="op">)</span><span class="op">[</span>, <span class="va">model_label</span> <span class="op">:=</span> <span class="st">'COX'</span><span class="op">]</span></span>
<span></span>
<span><span class="va">cond_2</span> <span class="op">&lt;-</span> <span class="va">hazard_frame_updated_nn</span><span class="op">$</span><span class="va">AP_i</span> <span class="op">==</span> <span class="va">my_ap</span> <span class="op">&amp;</span></span>
<span>  <span class="va">hazard_frame_updated_nn</span><span class="op">$</span><span class="va">claim_type</span> <span class="op">==</span> <span class="fl">1</span></span>
<span><span class="va">estimated_nn</span> <span class="op">&lt;-</span> <span class="va">hazard_frame_updated_nn</span><span class="op">[</span><span class="va">cond_2</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S_i"</span>, <span class="st">"DP_rev_i"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">estimated_nn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">estimated_nn</span><span class="op">)</span><span class="op">[</span>, <span class="va">model_label</span> <span class="op">:=</span> <span class="st">'NN'</span><span class="op">]</span></span>
<span></span>
<span><span class="va">cond_3</span> <span class="op">&lt;-</span> <span class="va">hazard_frame_updated_xgb</span><span class="op">$</span><span class="va">AP_i</span> <span class="op">==</span> <span class="va">my_ap</span> <span class="op">&amp;</span></span>
<span>  <span class="va">hazard_frame_updated_xgb</span><span class="op">$</span><span class="va">claim_type</span> <span class="op">==</span> <span class="fl">1</span></span>
<span><span class="va">estimated_xgb</span> <span class="op">&lt;-</span> <span class="va">hazard_frame_updated_xgb</span><span class="op">[</span><span class="va">cond_3</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S_i"</span>, <span class="st">"DP_rev_i"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">estimated_xgb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">estimated_xgb</span><span class="op">)</span><span class="op">[</span>, <span class="va">model_label</span> <span class="op">:=</span> <span class="st">'XGB'</span><span class="op">]</span></span>
<span></span>
<span><span class="va">dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">estimated_cox</span>, <span class="va">estimated_nn</span>, <span class="va">estimated_xgb</span><span class="op">)</span></span></code></pre></div>
<p>Plot the fitted survival curve for the three models.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">dt</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">DP_rev_i</span>, y <span class="op">=</span> <span class="va">S_i</span>, color <span class="op">=</span> <span class="va">model_label</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">model_label</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">'line'</span>,</span>
<span>    x <span class="op">=</span> <span class="va">true_curve</span><span class="op">$</span><span class="va">DP_rev_i</span>,</span>
<span>    y <span class="op">=</span> <span class="va">true_curve</span><span class="op">$</span><span class="va">S_i</span>,</span>
<span>    lty <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span></span>
<span>    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">440</span>, <span class="fl">940</span><span class="op">)</span>,</span>
<span>    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1440"</span>, <span class="st">"1000"</span>, <span class="st">"500"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">.001</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Development time"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Survival function"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Model"</span>,</span>
<span>                     values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#AAAABC"</span>, <span class="st">"#a71429"</span>, <span class="st">"#4169E1"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    legend.position <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>    text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>,</span>
<span>    axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span></span>
<span>      angle <span class="op">=</span> <span class="fl">90</span>,</span>
<span>      vjust <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>      hjust <span class="op">=</span> <span class="fl">1</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="fitting-and-scoring">Fitting and scoring<a class="anchor" aria-label="anchor" href="#fitting-and-scoring"></a>
</h2>
<p>In this Section we show how we fitted and scored our models. While we
only show an example for COX, the other models were fitted and scored in
a similar fashion.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">seed</span> <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="va">scenario</span> <span class="op">=</span> <span class="fl">0</span></span>
<span></span>
<span><span class="va">input_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/data_generator.html">data_generator</a></span><span class="op">(</span></span>
<span>  random_seed <span class="op">=</span> <span class="va">seed</span>,</span>
<span>  scenario <span class="op">=</span> <span class="va">scenario</span>,</span>
<span>  time_unit <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">360</span>,</span>
<span>  years <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  period_exposure <span class="op">=</span> <span class="fl">200</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">individual_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/IndividualDataPP.html">IndividualDataPP</a></span><span class="op">(</span></span>
<span>  <span class="va">input_data</span>,</span>
<span>  id <span class="op">=</span> <span class="st">"claim_number"</span>,</span>
<span>  continuous_features <span class="op">=</span> <span class="st">"AP_i"</span>,</span>
<span>  categorical_features <span class="op">=</span> <span class="st">"claim_type"</span>,</span>
<span>  accident_period <span class="op">=</span> <span class="st">"AP"</span>,</span>
<span>  calendar_period <span class="op">=</span> <span class="st">"RP"</span>,</span>
<span>  input_time_granularity <span class="op">=</span> <span class="st">"days"</span>,</span>
<span>  output_time_granularity <span class="op">=</span> <span class="st">"quarters"</span>,</span>
<span>  years <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  continuous_features_spline <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  calendar_period_extrapolation <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="fitting">Fitting<a class="anchor" aria-label="anchor" href="#fitting"></a>
</h3>
<div class="section level4">
<h4 id="time-to-fit-and-predict">Time to fit and predict<a class="anchor" aria-label="anchor" href="#time-to-fit-and-predict"></a>
</h4>
<p>Measuring computation time.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">resurv_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ReSurv.html">ReSurv</a></span><span class="op">(</span><span class="va">individual_data</span>, hazard_model <span class="op">=</span> <span class="st">"COX"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">resurv_fit_predict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">resurv_fit</span>, grouping_method <span class="op">=</span> <span class="st">"probability"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="va">start</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="scoring">Scoring<a class="anchor" aria-label="anchor" href="#scoring"></a>
</h3>
<div class="section level4">
<h4 id="scoring-on-a-quarterly-grid-">Scoring on a Quarterly grid.<a class="anchor" aria-label="anchor" href="#scoring-on-a-quarterly-grid-"></a>
</h4>
<p>Total absolute relative error and total absolute error by calendar
time on a quarterly grid.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">conversion_factor</span> <span class="op">&lt;-</span> <span class="va">individual_data</span><span class="op">$</span><span class="va">conversion_factor</span></span>
<span></span>
<span><span class="va">max_dp_i</span> <span class="op">&lt;-</span> <span class="fl">1440</span></span>
<span></span>
<span><span class="co"># Compute the continuously Ranked Probability Score (CRPS) ----</span></span>
<span></span>
<span><span class="va">crps_dt</span> <span class="op">&lt;-</span> <span class="fu">ReSurv</span><span class="fu">::</span><span class="fu"><a href="../reference/survival_crps.html">survival_crps</a></span><span class="op">(</span><span class="va">resurv_fit</span><span class="op">)</span></span>
<span><span class="va">crps_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">crps_dt</span><span class="op">$</span><span class="va">crps</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute the ARE tot ----</span></span>
<span></span>
<span><span class="va">true_output</span> <span class="op">&lt;-</span> <span class="va">resurv_fit</span><span class="op">$</span><span class="va">IndividualDataPP</span><span class="op">$</span><span class="va">full.data</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    DP_rev_o <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">max_dp_i</span> <span class="op">*</span> <span class="va">conversion_factor</span><span class="op">)</span> <span class="op">-</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">DP_i</span> <span class="op">*</span> <span class="va">conversion_factor</span> <span class="op">+</span></span>
<span>                <span class="op">(</span><span class="op">(</span><span class="va">AP_i</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="op">(</span></span>
<span>                  <span class="fl">1</span> <span class="op">/</span> <span class="va">conversion_factor</span></span>
<span>                <span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="va">conversion_factor</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span>,</span>
<span>    AP_o <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">AP_i</span> <span class="op">*</span> <span class="va">conversion_factor</span><span class="op">)</span>,</span>
<span>    TR_o <span class="op">=</span> <span class="va">AP_o</span> <span class="op">-</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">DP_rev_o</span> <span class="op">&lt;=</span> <span class="va">TR_o</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">claim_type</span>, <span class="va">AP_o</span>, <span class="va">DP_rev_o</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>claim_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">claim_type</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarize</span><span class="op">(</span>I <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">I</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">DP_rev_o</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">out_list</span> <span class="op">&lt;-</span> <span class="va">resurv_fit_predict</span><span class="op">$</span><span class="va">long_triangle_format_out</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="va">out_list</span><span class="op">$</span><span class="va">output_granularity</span></span>
<span></span>
<span><span class="co">#Total output</span></span>
<span><span class="va">score_total</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"claim_type"</span>, <span class="st">"AP_o"</span>, <span class="st">"DP_o"</span>, <span class="st">"expected_counts"</span><span class="op">)</span><span class="op">]</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>DP_rev_o <span class="op">=</span> <span class="fl">16</span> <span class="op">-</span> <span class="va">DP_o</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">inner_join</span><span class="op">(</span><span class="va">true_output</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"claim_type"</span>, <span class="st">"AP_o"</span>, <span class="st">"DP_rev_o"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>ave <span class="op">=</span> <span class="va">I</span> <span class="op">-</span> <span class="va">expected_counts</span>, abs_ave <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">ave</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># from here it is reformulated for the are tot</span></span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">AP_o</span>, <span class="va">DP_rev_o</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">reframe</span><span class="op">(</span>abs_ave <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">ave</span><span class="op">)</span><span class="op">)</span>, I <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">I</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">are_tot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">score_total</span><span class="op">$</span><span class="va">abs_ave</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">score_total</span><span class="op">$</span><span class="va">I</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">dfs_output</span> <span class="op">&lt;-</span> <span class="va">out</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>DP_rev_o <span class="op">=</span> <span class="fl">16</span> <span class="op">-</span> <span class="va">DP_o</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">AP_o</span>, <span class="va">claim_type</span>, <span class="va">DP_rev_o</span>, <span class="va">f_o</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>DP_rev_o <span class="op">=</span> <span class="va">DP_rev_o</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">distinct</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Cashflow on output scale.Etc quarterly cashflow development</span></span>
<span><span class="va">score_diagonal</span> <span class="op">&lt;-</span> <span class="va">resurv_fit</span><span class="op">$</span><span class="va">IndividualDataPP</span><span class="op">$</span><span class="va">full.data</span>  <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    DP_rev_o <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">max_dp_i</span> <span class="op">*</span> <span class="va">conversion_factor</span><span class="op">)</span> <span class="op">-</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">DP_i</span> <span class="op">*</span> <span class="va">conversion_factor</span> <span class="op">+</span></span>
<span>                <span class="op">(</span><span class="op">(</span><span class="va">AP_i</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="op">(</span></span>
<span>                  <span class="fl">1</span> <span class="op">/</span> <span class="va">conversion_factor</span></span>
<span>                <span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="va">conversion_factor</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span>,</span>
<span>    AP_o <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">AP_i</span> <span class="op">*</span> <span class="va">conversion_factor</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">claim_type</span>, <span class="va">AP_o</span>, <span class="va">DP_rev_o</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>claim_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">claim_type</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarize</span><span class="op">(</span>I <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">I</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">claim_type</span>, <span class="va">AP_o</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">DP_rev_o</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>I_cum <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">I</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>I_cum_lag <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">I_cum</span>, default <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="va">dfs_output</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AP_o"</span>, <span class="st">"claim_type"</span>, <span class="st">"DP_rev_o"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>I_cum_hat <span class="op">=</span>  <span class="va">I_cum_lag</span> <span class="op">*</span> <span class="va">f_o</span>,</span>
<span>         RP_o <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">DP_rev_o</span><span class="op">)</span> <span class="op">-</span> <span class="va">DP_rev_o</span> <span class="op">+</span> <span class="va">AP_o</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">inner_join</span><span class="op">(</span><span class="va">true_output</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AP_o"</span>, <span class="st">"DP_rev_o"</span><span class="op">)</span><span class="op">]</span> <span class="op">%&gt;%</span>  <span class="fu">distinct</span><span class="op">(</span><span class="op">)</span></span>
<span>             , by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AP_o"</span>, <span class="st">"DP_rev_o"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">AP_o</span>, <span class="va">DP_rev_o</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">reframe</span><span class="op">(</span>abs_ave2_diag <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">I_cum_hat</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">I_cum</span><span class="op">)</span><span class="op">)</span>, I <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">I</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">are_cal_q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">score_diagonal</span><span class="op">$</span><span class="va">abs_ave2_diag</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">score_diagonal</span><span class="op">$</span><span class="va">I</span><span class="op">)</span></span></code></pre></div>
<p>Scoring on an yearly grid.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">individual_data2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/IndividualDataPP.html">IndividualDataPP</a></span><span class="op">(</span></span>
<span>  <span class="va">input_data</span>,</span>
<span>  id <span class="op">=</span> <span class="st">"claim_number"</span>,</span>
<span>  continuous_features <span class="op">=</span> <span class="st">"AP_i"</span>,</span>
<span>  categorical_features <span class="op">=</span> <span class="st">"claim_type"</span>,</span>
<span>  accident_period <span class="op">=</span> <span class="st">"AP"</span>,</span>
<span>  calendar_period <span class="op">=</span> <span class="st">"RP"</span>,</span>
<span>  input_time_granularity <span class="op">=</span> <span class="st">"days"</span>,</span>
<span>  output_time_granularity <span class="op">=</span> <span class="st">"years"</span>,</span>
<span>  years <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  continuous_features_spline <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  calendar_period_extrapolation <span class="op">=</span> <span class="cn">F</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">resurv_predict_yearly</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">resurv_fit</span>, </span>
<span>                                 newdata <span class="op">=</span> <span class="va">individual_data2</span>, </span>
<span>                                 grouping_method <span class="op">=</span> <span class="st">"probability"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">conversion_factor</span> <span class="op">&lt;-</span> <span class="va">individual_data2</span><span class="op">$</span><span class="va">conversion_factor</span></span>
<span></span>
<span></span>
<span><span class="va">max_dp_i</span> <span class="op">&lt;-</span> <span class="fl">1440</span></span>
<span></span>
<span><span class="va">true_output</span> <span class="op">&lt;-</span> <span class="va">individual_data2</span><span class="op">$</span><span class="va">full.data</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    DP_rev_o <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">max_dp_i</span> <span class="op">*</span> <span class="va">conversion_factor</span><span class="op">)</span> <span class="op">-</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">DP_i</span> <span class="op">*</span> <span class="va">conversion_factor</span> <span class="op">+</span></span>
<span>                <span class="op">(</span><span class="op">(</span><span class="va">AP_i</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="op">(</span></span>
<span>                  <span class="fl">1</span> <span class="op">/</span> <span class="va">conversion_factor</span></span>
<span>                <span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="va">conversion_factor</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span>,</span>
<span>    AP_o <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">AP_i</span> <span class="op">*</span> <span class="va">conversion_factor</span><span class="op">)</span>,</span>
<span>    TR_o <span class="op">=</span> <span class="va">AP_o</span> <span class="op">-</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">DP_rev_o</span> <span class="op">&lt;=</span> <span class="va">TR_o</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">claim_type</span>, <span class="va">AP_o</span>, <span class="va">DP_rev_o</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>claim_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">claim_type</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarize</span><span class="op">(</span>I <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">I</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">DP_rev_o</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="va">out_list_yearly</span> <span class="op">&lt;-</span> <span class="va">resurv_predict_yearly</span><span class="op">$</span><span class="va">long_triangle_format_out</span></span>
<span><span class="va">out_yearly</span> <span class="op">&lt;-</span> <span class="va">out_list_yearly</span><span class="op">$</span><span class="va">output_granularity</span></span>
<span></span>
<span><span class="va">dfs_output</span> <span class="op">&lt;-</span> <span class="va">out_yearly</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>DP_rev_o <span class="op">=</span> <span class="fl">4</span> <span class="op">-</span> <span class="va">DP_o</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">AP_o</span>, <span class="va">claim_type</span>, <span class="va">DP_rev_o</span>, <span class="va">f_o</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>DP_rev_o <span class="op">=</span> <span class="va">DP_rev_o</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">distinct</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">score_diagonal_yearly</span> <span class="op">&lt;-</span> <span class="va">individual_data2</span><span class="op">$</span><span class="va">full.data</span>  <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    DP_rev_o <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">max_dp_i</span> <span class="op">*</span> <span class="va">conversion_factor</span><span class="op">)</span> <span class="op">-</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">DP_i</span> <span class="op">*</span> <span class="va">conversion_factor</span> <span class="op">+</span></span>
<span>                <span class="op">(</span><span class="op">(</span><span class="va">AP_i</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="op">(</span></span>
<span>                  <span class="fl">1</span> <span class="op">/</span> <span class="va">conversion_factor</span></span>
<span>                <span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="va">conversion_factor</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span>,</span>
<span>    AP_o <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">AP_i</span> <span class="op">*</span> <span class="va">conversion_factor</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">claim_type</span>, <span class="va">AP_o</span>, <span class="va">DP_rev_o</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>claim_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">claim_type</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarize</span><span class="op">(</span>I <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">I</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">claim_type</span>, <span class="va">AP_o</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">DP_rev_o</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>I_cum <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">I</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>I_cum_lag <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">I_cum</span>, default <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="va">dfs_output</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AP_o"</span>, <span class="st">"claim_type"</span>, <span class="st">"DP_rev_o"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>I_cum_hat <span class="op">=</span>  <span class="va">I_cum_lag</span> <span class="op">*</span> <span class="va">f_o</span>,</span>
<span>         RP_o <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">DP_rev_o</span><span class="op">)</span> <span class="op">-</span> <span class="va">DP_rev_o</span> <span class="op">+</span> <span class="va">AP_o</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">inner_join</span><span class="op">(</span><span class="va">true_output</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AP_o"</span>, <span class="st">"DP_rev_o"</span><span class="op">)</span><span class="op">]</span> <span class="op">%&gt;%</span>  <span class="fu">distinct</span><span class="op">(</span><span class="op">)</span></span>
<span>             , by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AP_o"</span>, <span class="st">"DP_rev_o"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">AP_o</span>, <span class="va">DP_rev_o</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">reframe</span><span class="op">(</span>abs_ave2_diag <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">I_cum_hat</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">I_cum</span><span class="op">)</span><span class="op">)</span>, I <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">I</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">are_cal_y</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">score_diagonal_yearly</span><span class="op">$</span><span class="va">abs_ave2_diag</span><span class="op">)</span> <span class="op">/</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">score_diagonal_yearly</span><span class="op">$</span><span class="va">I</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Emil Hofman, Gabriele Pittarello, Munir Hiabu.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
