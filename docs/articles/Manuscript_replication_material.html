<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A machine learning approach based on survival analysis for IBNR frequencies in non-life reserving â€¢ ReSurv</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="A machine learning approach based on survival analysis for IBNR frequencies in non-life reserving">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ReSurv</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/cas_call.html">2024 Reserving Call Paper Program on Technology and the Reserving Actuary</a>
    </li>
    <li>
      <a href="../articles/hp_tuning.html">Hyperparameters tuning</a>
    </li>
    <li>
      <a href="../articles/Manuscript_replication_material.html">A machine learning approach based on survival analysis for IBNR frequencies in non-life reserving</a>
    </li>
    <li>
      <a href="../articles/simulate_individual_data.html">Simulate individual data</a>
    </li>
    <li>
      <a href="../articles/variables_importance.html">Exploring the variables importance</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/edhofman/ReSurv/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>A machine learning approach based on survival
analysis for IBNR frequencies in non-life reserving</h1>
                        <h4 data-toc-skip class="author">Gabriele
Pittarello, Emil Hofman</h4>
            
            <h4 data-toc-skip class="date">2024-11-07</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/edhofman/ReSurv/blob/HEAD/vignettes/Manuscript_replication_material.Rmd" class="external-link"><code>vignettes/Manuscript_replication_material.Rmd</code></a></small>
      <div class="hidden name"><code>Manuscript_replication_material.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In this vignette, we provide the supplementary material to replicate
the results of the manuscript <strong>A machine learning approach based
on survival analysis for IBNR frequencies in non-life
reserving</strong>.</p>
<p>We remark that the real data that we used to obtain the results that
we included in the manuscript are private and will not be shared.</p>
<p>With reference to the code related to the simulation case study, we
wanted to make this vignette quickly reproducible and drop extensive
computations. The full code that we implemented can be found at the
GitHub repository <a href="https://github.com/gpitt71/resurv-replication-code" class="external-link">resurv-replication-code</a>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/edhofman/ReSurv" class="external-link">ReSurv</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="figure-1">Figure 1<a class="anchor" aria-label="anchor" href="#figure-1"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">input_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/data_generator.html">data_generator</a></span><span class="op">(</span>random_seed <span class="op">=</span> <span class="fl">7</span>,</span>
<span>                             scenario<span class="op">=</span><span class="fl">3</span>,</span>
<span>                             time_unit <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">360</span>,</span>
<span>                             years <span class="op">=</span> <span class="fl">4</span>,</span>
<span>                             period_exposure <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">individual_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/IndividualDataPP.html">IndividualDataPP</a></span><span class="op">(</span><span class="va">input_data</span>,</span>
<span>                                  id<span class="op">=</span><span class="st">"claim_number"</span>,</span>
<span>                                  continuous_features<span class="op">=</span><span class="st">"AP_i"</span>,</span>
<span>                                  categorical_features<span class="op">=</span><span class="st">"claim_type"</span>,</span>
<span>                                  accident_period<span class="op">=</span><span class="st">"AP"</span>,</span>
<span>                                  calendar_period<span class="op">=</span><span class="st">"RP"</span>,</span>
<span>                                  input_time_granularity <span class="op">=</span> <span class="st">"days"</span>,</span>
<span>                                  output_time_granularity <span class="op">=</span> <span class="st">"quarters"</span>,</span>
<span>                                  years<span class="op">=</span><span class="fl">4</span>,</span>
<span>                                  continuous_features_spline<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>                                  calendar_period_extrapolation<span class="op">=</span><span class="cn">F</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hparameters</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>params<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>booster<span class="op">=</span><span class="st">"gbtree"</span>,</span>
<span>                               eta<span class="op">=</span><span class="fl">0.2234094</span>,</span>
<span>                               subsample<span class="op">=</span><span class="fl">0.8916594</span>,</span>
<span>                               alpha<span class="op">=</span><span class="fl">12.44775</span>,</span>
<span>                               lambda<span class="op">=</span><span class="fl">5.714286</span>,</span>
<span>                               min_child_weight<span class="op">=</span><span class="fl">4.211996</span>,</span>
<span>                               max_depth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>                   print_every_n <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                   nrounds<span class="op">=</span><span class="fl">3000</span>,</span>
<span>                   verbose<span class="op">=</span><span class="cn">F</span>,</span>
<span>                   early_stopping_rounds <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">resurv.fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ReSurv.html">ReSurv</a></span><span class="op">(</span><span class="va">individual_data</span>,</span>
<span>                     hazard_model <span class="op">=</span> <span class="st">"XGB"</span>,</span>
<span>                     hparameters <span class="op">=</span> <span class="va">hparameters</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">resurv.fit.predict.Q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">resurv.fit</span>,</span>
<span>                                grouping_method <span class="op">=</span> <span class="st">"probability"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">individual_dataY</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/IndividualDataPP.html">IndividualDataPP</a></span><span class="op">(</span><span class="va">input_data</span>,</span>
<span>                                   id<span class="op">=</span><span class="st">"claim_number"</span>,</span>
<span>                                   continuous_features<span class="op">=</span><span class="st">"AP_i"</span>,</span>
<span>                                   categorical_features<span class="op">=</span><span class="st">"claim_type"</span>,</span>
<span>                                   accident_period<span class="op">=</span><span class="st">"AP"</span>,</span>
<span>                                   calendar_period<span class="op">=</span><span class="st">"RP"</span>,</span>
<span>                                   input_time_granularity <span class="op">=</span> <span class="st">"days"</span>,</span>
<span>                                   output_time_granularity <span class="op">=</span> <span class="st">"years"</span>,</span>
<span>                                   years<span class="op">=</span><span class="fl">4</span>,</span>
<span>                                   continuous_features_spline<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>                                   calendar_period_extrapolation<span class="op">=</span><span class="cn">F</span><span class="op">)</span></span>
<span></span>
<span><span class="va">resurv.fit.predict.Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">resurv.fit</span>,</span>
<span>                                newdata<span class="op">=</span><span class="va">individual_dataY</span>,</span>
<span>                                grouping_method <span class="op">=</span> <span class="st">"probability"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">individual_dataM</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/IndividualDataPP.html">IndividualDataPP</a></span><span class="op">(</span><span class="va">input_data</span>,</span>
<span>                                   id<span class="op">=</span><span class="st">"claim_number"</span>,</span>
<span>                                   continuous_features<span class="op">=</span><span class="st">"AP_i"</span>,</span>
<span>                                   categorical_features<span class="op">=</span><span class="st">"claim_type"</span>,</span>
<span>                                   accident_period<span class="op">=</span><span class="st">"AP"</span>,</span>
<span>                                   calendar_period<span class="op">=</span><span class="st">"RP"</span>,</span>
<span>                                   input_time_granularity <span class="op">=</span> <span class="st">"days"</span>,</span>
<span>                                   output_time_granularity <span class="op">=</span> <span class="st">"months"</span>,</span>
<span>                                   years<span class="op">=</span><span class="fl">4</span>,</span>
<span>                                   continuous_features_spline<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>                                   calendar_period_extrapolation<span class="op">=</span><span class="cn">F</span><span class="op">)</span></span>
<span></span>
<span><span class="va">resurv.fit.predict.M</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">resurv.fit</span>,</span>
<span>                                newdata<span class="op">=</span><span class="va">individual_dataM</span>,</span>
<span>                                grouping_method <span class="op">=</span> <span class="st">"probability"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">dtb_2_plot_M</span> <span class="op">&lt;-</span> <span class="va">resurv.fit.predict.M</span><span class="op">$</span><span class="va">hazard_frame_output</span></span>
<span><span class="va">dtb_2_plot_M</span><span class="op">=</span><span class="va">dtb_2_plot_M</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>DP_o<span class="op">=</span><span class="fl">48</span><span class="op">-</span><span class="va">DP_rev_o</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dtb_2_plot_Q</span> <span class="op">&lt;-</span> <span class="va">resurv.fit.predict.Q</span><span class="op">$</span><span class="va">hazard_frame_output</span></span>
<span></span>
<span><span class="va">dtb_2_plot_Q</span><span class="op">=</span><span class="va">dtb_2_plot_Q</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>DP_o<span class="op">=</span><span class="fl">16</span><span class="op">-</span><span class="va">DP_rev_o</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dtb_2_plot_Y</span> <span class="op">&lt;-</span> <span class="va">resurv.fit.predict.Y</span><span class="op">$</span><span class="va">hazard_frame_output</span></span>
<span></span>
<span><span class="va">dtb_2_plot_Y</span><span class="op">=</span><span class="va">dtb_2_plot_Y</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>DP_o<span class="op">=</span><span class="fl">4</span><span class="op">-</span><span class="va">DP_rev_o</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="figure-1b">Figure 1b<a class="anchor" aria-label="anchor" href="#figure-1b"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CL</span> <span class="op">=</span> <span class="va">resurv.fit</span><span class="op">$</span><span class="va">IndividualDataPP</span><span class="op">$</span><span class="va">training.data</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>DP_o <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">resurv.fit.predict.Q</span><span class="op">$</span><span class="va">hazard_frame_output</span><span class="op">$</span><span class="va">DP_rev_o</span><span class="op">)</span><span class="op">-</span><span class="va">DP_rev_o</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">AP_o</span>, <span class="va">DP_o</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarize</span><span class="op">(</span>I<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">I</span><span class="op">)</span>, .groups<span class="op">=</span><span class="st">"drop"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">AP_o</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="va">DP_o</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>I_cum <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">I</span><span class="op">)</span>,</span>
<span>         I_cum_lag <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">I_cum</span>, default<span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">DP_o</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">reframe</span><span class="op">(</span>df_o <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">I_cum</span><span class="op">*</span><span class="op">(</span><span class="va">AP_o</span><span class="op">&lt;=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">resurv.fit</span><span class="op">$</span><span class="va">IndividualDataPP</span><span class="op">$</span><span class="va">training.data</span><span class="op">$</span><span class="va">AP_o</span><span class="op">)</span><span class="op">-</span><span class="va">DP_o</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">I_cum_lag</span><span class="op">*</span><span class="op">(</span><span class="va">AP_o</span><span class="op">&lt;=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">resurv.fit</span><span class="op">$</span><span class="va">IndividualDataPP</span><span class="op">$</span><span class="va">training.data</span><span class="op">$</span><span class="va">AP_o</span><span class="op">)</span><span class="op">-</span><span class="va">DP_o</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>          I<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">I</span><span class="op">*</span><span class="op">(</span><span class="va">AP_o</span><span class="op">&lt;=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">resurv.fit</span><span class="op">$</span><span class="va">IndividualDataPP</span><span class="op">$</span><span class="va">training.data</span><span class="op">$</span><span class="va">AP_o</span><span class="op">)</span><span class="op">-</span><span class="va">DP_o</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>DP_o_join <span class="op">=</span> <span class="va">DP_o</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Figure 1a ----</span></span>
<span></span>
<span><span class="va">CL</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">DP_o</span><span class="op">&gt;</span><span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">DP_o</span>,</span>
<span>             y<span class="op">=</span><span class="va">df_o</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth<span class="op">=</span><span class="fl">2.5</span>,color<span class="op">=</span><span class="st">"#454555"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">"Chain ladder"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Development quarter"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Development factor"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">dtb_2_plot_Q</span><span class="op">$</span><span class="va">df_o</span><span class="op">)</span><span class="op">+</span><span class="fl">.01</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">rel</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ticks.at</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">16</span>,by<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">labels.as</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">ticks.at</span><span class="op">)</span></span></code></pre></div>
<p>` ## Figure 1f</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Figure 1c ----</span></span>
<span></span>
<span><span class="va">ap</span><span class="op">=</span><span class="fl">15</span></span>
<span><span class="va">ct</span><span class="op">=</span><span class="fl">1</span></span>
<span><span class="va">dtb_2_plot_Q</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">claim_type</span><span class="op">==</span><span class="va">ct</span>,</span>
<span>         <span class="va">AP_o</span><span class="op">==</span><span class="va">ap</span>,</span>
<span>         <span class="va">DP_o</span><span class="op">&gt;</span><span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">DP_o</span>,</span>
<span>             y<span class="op">=</span><span class="va">df_o</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth<span class="op">=</span><span class="fl">2.5</span>,color<span class="op">=</span><span class="st">"royalblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">dtb_2_plot_Q</span><span class="op">$</span><span class="va">df_o</span><span class="op">)</span><span class="op">+</span><span class="fl">.01</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"XGB: Accident Quarter"</span>, <span class="va">ap</span>, <span class="st">"Claim Type"</span>, <span class="va">ct</span><span class="op">)</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Development quarter"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Development factor"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="va">ticks.at</span>,</span>
<span>                     labels <span class="op">=</span> <span class="va">labels.as</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">rel</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="figure-1g">Figure 1g<a class="anchor" aria-label="anchor" href="#figure-1g"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Figure 1d ----</span></span>
<span></span>
<span><span class="va">ap</span><span class="op">=</span><span class="fl">12</span></span>
<span><span class="va">ct</span><span class="op">=</span><span class="fl">0</span></span>
<span><span class="va">dtb_2_plot_Q</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">claim_type</span><span class="op">==</span><span class="va">ct</span>,</span>
<span>         <span class="va">AP_o</span><span class="op">==</span><span class="va">ap</span>,</span>
<span>         <span class="va">DP_o</span><span class="op">&gt;</span><span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">DP_o</span>,</span>
<span>             y<span class="op">=</span><span class="va">df_o</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth<span class="op">=</span><span class="fl">2.5</span>,color<span class="op">=</span><span class="st">"royalblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">dtb_2_plot_Q</span><span class="op">$</span><span class="va">df_o</span><span class="op">)</span><span class="op">+</span><span class="fl">.01</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"XGB: Accident Quarter"</span>, <span class="va">ap</span>, <span class="st">"Claim Type"</span>, <span class="va">ct</span><span class="op">)</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Development quarter"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Development factor"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="va">ticks.at</span>,</span>
<span>                     labels <span class="op">=</span> <span class="va">labels.as</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">rel</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="figure-1h">Figure 1h<a class="anchor" aria-label="anchor" href="#figure-1h"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ap</span><span class="op">=</span><span class="fl">16</span></span>
<span><span class="va">ct</span><span class="op">=</span><span class="fl">0</span></span>
<span><span class="va">dtb_2_plot_Q</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">claim_type</span><span class="op">==</span><span class="va">ct</span>,</span>
<span>         <span class="va">AP_o</span><span class="op">==</span><span class="va">ap</span>,</span>
<span>         <span class="va">DP_o</span><span class="op">&gt;</span><span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">DP_o</span>,</span>
<span>             y<span class="op">=</span><span class="va">df_o</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth<span class="op">=</span><span class="fl">2.5</span>,color<span class="op">=</span><span class="st">"royalblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">dtb_2_plot_Q</span><span class="op">$</span><span class="va">df_o</span><span class="op">)</span><span class="op">+</span><span class="fl">.01</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"XGB: Accident Quarter"</span>, <span class="va">ap</span>, <span class="st">"Claim Type"</span>, <span class="va">ct</span><span class="op">)</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Development quarter"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Development factor"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="va">ticks.at</span>,</span>
<span>                     labels <span class="op">=</span> <span class="va">labels.as</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">rel</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="st">"C:\\Users\\gpitt\\Pictures\\ReSurv\\XGBdfoquarters2c.eps"</span>,</span>
<span>       width <span class="op">=</span> <span class="fl">5.5</span>,</span>
<span>       height<span class="op">=</span> <span class="fl">5</span>,</span>
<span>       device<span class="op">=</span><span class="va">cairo_ps</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="figure-1a">Figure 1a<a class="anchor" aria-label="anchor" href="#figure-1a"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ticks.at</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">48</span>,<span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">labels.as</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">ticks.at</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="va">CL_months</span> <span class="op">=</span> <span class="va">individual_dataM</span><span class="op">$</span><span class="va">training.data</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>DP_o <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">resurv.fit.predict.M</span><span class="op">$</span><span class="va">hazard_frame_output</span><span class="op">$</span><span class="va">DP_rev_o</span><span class="op">)</span><span class="op">-</span><span class="va">DP_rev_o</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">AP_o</span>, <span class="va">DP_o</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarize</span><span class="op">(</span>I<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">I</span><span class="op">)</span>, .groups<span class="op">=</span><span class="st">"drop"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">AP_o</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="va">DP_o</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>I_cum <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">I</span><span class="op">)</span>,</span>
<span>         I_cum_lag <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">I_cum</span>, default<span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">DP_o</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">reframe</span><span class="op">(</span>df_o <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">I_cum</span><span class="op">*</span><span class="op">(</span><span class="va">AP_o</span><span class="op">&lt;=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">individual_dataM</span><span class="op">$</span><span class="va">training.data</span><span class="op">$</span><span class="va">AP_o</span><span class="op">)</span><span class="op">-</span><span class="va">DP_o</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">I_cum_lag</span><span class="op">*</span><span class="op">(</span><span class="va">AP_o</span><span class="op">&lt;=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">individual_dataM</span><span class="op">$</span><span class="va">training.data</span><span class="op">$</span><span class="va">AP_o</span><span class="op">)</span><span class="op">-</span><span class="va">DP_o</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>          I<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">I</span><span class="op">*</span><span class="op">(</span><span class="va">AP_o</span><span class="op">&lt;=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">individual_dataM</span><span class="op">$</span><span class="va">training.data</span><span class="op">$</span><span class="va">AP_o</span><span class="op">)</span><span class="op">-</span><span class="va">DP_o</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>DP_o_join <span class="op">=</span> <span class="va">DP_o</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">CL_months</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">DP_o</span><span class="op">&gt;</span><span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">DP_o</span>,</span>
<span>             y<span class="op">=</span><span class="va">df_o</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth<span class="op">=</span><span class="fl">2.5</span>,color<span class="op">=</span><span class="st">"#454555"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">"Chain ladder"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Development month"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Development factor"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2.5</span><span class="op">+</span><span class="fl">.01</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="va">ticks.at</span>,</span>
<span>                     labels <span class="op">=</span> <span class="va">labels.as</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">rel</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="figure-1c">Figure 1c<a class="anchor" aria-label="anchor" href="#figure-1c"></a>
</h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ct</span><span class="op">=</span><span class="fl">1</span></span>
<span><span class="va">ap</span><span class="op">=</span><span class="fl">7</span></span>
<span><span class="va">dtb_2_plot_M</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">claim_type</span><span class="op">==</span><span class="va">ct</span>,</span>
<span>         <span class="va">AP_o</span><span class="op">==</span><span class="va">ap</span>,</span>
<span>         <span class="va">DP_o</span><span class="op">&gt;</span><span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">DP_o</span>,</span>
<span>             y<span class="op">=</span><span class="va">df_o</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth<span class="op">=</span><span class="fl">2.5</span>,color<span class="op">=</span><span class="st">"#a71429"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">dtb_2_plot_M</span><span class="op">$</span><span class="va">df_o</span><span class="op">)</span><span class="op">+</span><span class="fl">.01</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"XGB: Accident Month"</span>, <span class="va">ap</span>, <span class="st">"Claim Type"</span>, <span class="va">ct</span><span class="op">)</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Development month"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Development factor"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="va">ticks.at</span>,</span>
<span>                     labels <span class="op">=</span> <span class="va">labels.as</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">rel</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="figure-1d">Figure 1d<a class="anchor" aria-label="anchor" href="#figure-1d"></a>
</h3>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ct</span><span class="op">=</span><span class="fl">0</span></span>
<span><span class="va">ap</span><span class="op">=</span><span class="fl">9</span></span>
<span><span class="va">dtb_2_plot_M</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">claim_type</span><span class="op">==</span><span class="va">ct</span>,</span>
<span>         <span class="va">AP_o</span><span class="op">==</span><span class="va">ap</span>,</span>
<span>         <span class="va">DP_o</span><span class="op">&gt;</span><span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">DP_o</span>,</span>
<span>             y<span class="op">=</span><span class="va">df_o</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth<span class="op">=</span><span class="fl">2.5</span>,color<span class="op">=</span><span class="st">"#a71429"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2.5</span><span class="op">+</span><span class="fl">.01</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"XGB: Accident Month"</span>, <span class="va">ap</span>, <span class="st">"Claim Type"</span>, <span class="va">ct</span><span class="op">)</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Development month"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Development factor"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="va">ticks.at</span>,</span>
<span>                     labels <span class="op">=</span> <span class="va">labels.as</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">rel</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="figure-1e">Figure 1e<a class="anchor" aria-label="anchor" href="#figure-1e"></a>
</h3>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ct</span><span class="op">=</span><span class="fl">0</span></span>
<span><span class="va">ap</span><span class="op">=</span><span class="fl">36</span></span>
<span></span>
<span><span class="va">dtb_2_plot_M</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">claim_type</span><span class="op">==</span><span class="va">ct</span>,</span>
<span>         <span class="va">AP_o</span><span class="op">==</span><span class="va">ap</span>,</span>
<span>         <span class="va">DP_o</span><span class="op">&gt;</span><span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">DP_o</span>,</span>
<span>             y<span class="op">=</span><span class="va">df_o</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth<span class="op">=</span><span class="fl">2.5</span>,color<span class="op">=</span><span class="st">"#a71429"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2.5</span><span class="op">+</span><span class="fl">.01</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"XGB: Accident Month"</span>, <span class="va">ap</span>, <span class="st">"Claim Type"</span>, <span class="va">ct</span><span class="op">)</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Development month"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Development factor"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="va">ticks.at</span>,</span>
<span>                     labels <span class="op">=</span> <span class="va">labels.as</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">rel</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="table-2">Table 2<a class="anchor" aria-label="anchor" href="#table-2"></a>
</h2>
<p>The models likelihood can be extracted using the following commands.
Table 2 shows the average negative log-likelihood for each scenario over
the different simulations, here we show the results for XGB, scenario
Delta and simulation number 7.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">resurv.fit</span><span class="op">$</span><span class="va">is_lkh</span></span>
<span><span class="co"># $metric</span></span>
<span><span class="co"># [1] "log-partial likelihood"</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># $value</span></span>
<span><span class="co"># [1] 8.598515</span></span>
<span></span>
<span><span class="va">resurv.fit</span><span class="op">$</span><span class="va">os_lkh</span></span>
<span><span class="co"># $metric</span></span>
<span><span class="co"># [1] "log-partial likelihood"</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># $value</span></span>
<span><span class="co"># [1] 7.220672</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="figure-4-and-figure-5">Figure 4 and Figure 5<a class="anchor" aria-label="anchor" href="#figure-4-and-figure-5"></a>
</h2>
<div class="section level3">
<h3 id="figure-4">Figure 4<a class="anchor" aria-label="anchor" href="#figure-4"></a>
</h3>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">beta</span><span class="op">=</span><span class="fl">2</span><span class="op">*</span><span class="fl">30</span></span>
<span><span class="va">lambda</span><span class="op">=</span><span class="fl">0.1</span> <span class="co">#1</span></span>
<span><span class="va">k</span><span class="op">=</span><span class="fl">1</span></span>
<span><span class="va">b</span><span class="op">=</span><span class="fl">1440</span></span>
<span><span class="va">alpha</span><span class="op">=</span><span class="fl">0.5</span></span>
<span><span class="va">beta0</span> <span class="op">=</span> <span class="fl">1.15129</span></span>
<span><span class="va">beta1</span> <span class="op">=</span> <span class="fl">1.95601</span></span>
<span></span>
<span><span class="va">F_correct_s0</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">alpha</span>, <span class="va">beta</span>, <span class="va">lambda</span>, <span class="va">k</span>,<span class="va">b</span>,<span class="va">beta_coef</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co">#nu/xi*(t/xi)^(nu-1)</span></span>
<span>  <span class="co">#exp(-(t/xi)^nu)/(1-exp(-(t/xi)^nu)*</span></span>
<span>  <span class="co">#nu/xi*(t/xi)^(nu-1)*exp(beta1)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">beta</span><span class="op">^</span><span class="va">alpha</span> <span class="op">*</span><span class="op">(</span><span class="va">lambda</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">beta_coef</span><span class="op">)</span><span class="op">^</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="va">alpha</span><span class="op">*</span><span class="va">k</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span><span class="op">^</span><span class="op">(</span><span class="va">alpha</span><span class="op">*</span><span class="va">k</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="va">t</span><span class="op">^</span><span class="op">(</span><span class="op">-</span><span class="va">alpha</span><span class="op">*</span><span class="va">k</span><span class="op">)</span><span class="op">-</span><span class="va">b</span><span class="op">^</span><span class="op">(</span><span class="op">-</span><span class="va">alpha</span><span class="op">*</span><span class="va">k</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">c_correct_grouped</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="va">b</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">t</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">i</span>,<span class="va">i</span><span class="op">+</span><span class="fl">1</span>, by<span class="op">=</span><span class="fl">0.001</span><span class="op">)</span></span>
<span>  <span class="va">n_t</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span></span>
<span>  <span class="va">c_correct_grouped</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fu">F_correct_s0</span><span class="op">(</span><span class="va">t</span>, <span class="va">alpha</span>,<span class="va">beta</span>,<span class="va">lambda</span>,<span class="va">k</span>,<span class="va">b</span>, <span class="va">beta0</span><span class="op">)</span> <span class="op">)</span><span class="op">/</span><span class="va">n_t</span></span>
<span><span class="op">}</span></span>
<span><span class="va">c_correct_grouped</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">c_correct_grouped</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">b</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">c_correct_grouped1</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="va">b</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">t</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">i</span>,<span class="va">i</span><span class="op">+</span><span class="fl">1</span>, by<span class="op">=</span><span class="fl">0.001</span><span class="op">)</span></span>
<span>  <span class="va">n_t</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span></span>
<span>  <span class="va">c_correct_grouped1</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fu">F_correct_s0</span><span class="op">(</span><span class="va">t</span>, <span class="va">alpha</span>,<span class="va">beta</span>,<span class="va">lambda</span>,<span class="va">k</span>,<span class="va">b</span>, <span class="va">beta1</span><span class="op">)</span> <span class="op">)</span><span class="op">/</span><span class="va">n_t</span></span>
<span><span class="op">}</span></span>
<span><span class="va">c_correct_grouped1</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">c_correct_grouped1</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">b</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">true_curve</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span><span class="st">'DP_rev_i'</span><span class="op">=</span><span class="op">(</span><span class="va">b</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="op">(</span><span class="va">b</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>,by<span class="op">=</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>                         <span class="st">'S_i'</span><span class="op">=</span><span class="fl">1</span><span class="op">-</span><span class="op">(</span><span class="va">c_correct_grouped1</span><span class="op">)</span>,</span>
<span>                         <span class="st">'model_label'</span><span class="op">=</span><span class="st">'TRUE'</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">input_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/data_generator.html">data_generator</a></span><span class="op">(</span>random_seed <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                             scenario<span class="op">=</span><span class="fl">0</span>,</span>
<span>                             time_unit <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">360</span>,</span>
<span>                             years <span class="op">=</span> <span class="fl">4</span>,</span>
<span>                             period_exposure <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">individual_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/IndividualDataPP.html">IndividualDataPP</a></span><span class="op">(</span><span class="va">input_data</span>,</span>
<span>                                  id<span class="op">=</span><span class="st">"claim_number"</span>,</span>
<span>                                  continuous_features<span class="op">=</span><span class="st">"AP_i"</span>,</span>
<span>                                  categorical_features<span class="op">=</span><span class="st">"claim_type"</span>,</span>
<span>                                  accident_period<span class="op">=</span><span class="st">"AP"</span>,</span>
<span>                                  calendar_period<span class="op">=</span><span class="st">"RP"</span>,</span>
<span>                                  input_time_granularity <span class="op">=</span> <span class="st">"days"</span>,</span>
<span>                                  output_time_granularity <span class="op">=</span> <span class="st">"quarters"</span>,</span>
<span>                                  years<span class="op">=</span><span class="fl">4</span>,</span>
<span>                                  continuous_features_spline<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>                                  calendar_period_extrapolation<span class="op">=</span><span class="cn">F</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">hparameters.xgb.01</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>params<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>booster<span class="op">=</span><span class="st">"gbtree"</span>,</span>
<span>                        eta<span class="op">=</span><span class="fl">0.9887265</span>,</span>
<span>                        subsample<span class="op">=</span><span class="fl">0.7924135</span>,</span>
<span>                        alpha<span class="op">=</span><span class="fl">10.85342</span>,</span>
<span>                        lambda<span class="op">=</span><span class="fl">6.213317</span>,</span>
<span>                        min_child_weight<span class="op">=</span><span class="fl">3.042204</span>,</span>
<span>                        max_depth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                        print_every_n <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                        nrounds<span class="op">=</span><span class="fl">3000</span>,</span>
<span>                        verbose<span class="op">=</span><span class="cn">F</span>,</span>
<span>                        early_stopping_rounds <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">hparameters.nn.01</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>num_layers<span class="op">=</span><span class="fl">2</span>,</span>
<span>                         early_stopping <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                         patience <span class="op">=</span> <span class="fl">350</span>,</span>
<span>                         verbose<span class="op">=</span><span class="cn">F</span>,</span>
<span>                         network_structure <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                         num_nodes <span class="op">=</span> <span class="fl">10</span>,</span>
<span>                         activation <span class="op">=</span> <span class="st">"SELU"</span>,</span>
<span>                         optim<span class="op">=</span> <span class="st">"SGD"</span>,</span>
<span>                         lr <span class="op">=</span> <span class="fl">0.2741031</span>,</span>
<span>                         xi<span class="op">=</span> <span class="fl">0.3829451</span>,</span>
<span>                         epsilon <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                         batch_size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fl">5000</span><span class="op">)</span>,</span>
<span>                         epochs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fl">5500</span><span class="op">)</span>,</span>
<span>                         num_workers<span class="op">=</span><span class="fl">0</span>,</span>
<span>                         tie<span class="op">=</span><span class="st">'Efron'</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">resurv.fit.cox.01</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ReSurv.html">ReSurv</a></span><span class="op">(</span><span class="va">individual_data</span>,</span>
<span>                             hazard_model <span class="op">=</span> <span class="st">"COX"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">resurv.fit.nn.01</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ReSurv.html">ReSurv</a></span><span class="op">(</span><span class="va">individual_data</span>,</span>
<span>                             hazard_model <span class="op">=</span> <span class="st">"NN"</span>,</span>
<span>                             hparameters <span class="op">=</span> <span class="va">hparameters.nn.01</span><span class="op">)</span></span>
<span></span>
<span><span class="va">resurv.fit.xgb.01</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ReSurv.html">ReSurv</a></span><span class="op">(</span><span class="va">individual_data</span>,</span>
<span>                             hazard_model <span class="op">=</span> <span class="st">"XGB"</span>,</span>
<span>                             hparameters <span class="op">=</span> <span class="va">hparameters.xgb.01</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hazard_frame_updated_cox</span> <span class="op">&lt;-</span> <span class="va">resurv.fit.cox.01</span><span class="op">$</span><span class="va">hazard_frame</span></span>
<span></span>
<span><span class="va">hazard_frame_updated_nn</span> <span class="op">&lt;-</span> <span class="va">resurv.fit.nn.01</span><span class="op">$</span><span class="va">hazard_frame</span></span>
<span></span>
<span><span class="va">hazard_frame_updated_xgb</span> <span class="op">&lt;-</span> <span class="va">resurv.fit.xgb.01</span><span class="op">$</span><span class="va">hazard_frame</span></span>
<span></span>
<span></span>
<span><span class="va">estimated_cox</span> <span class="op">&lt;-</span> <span class="va">hazard_frame_updated_cox</span><span class="op">[</span><span class="va">hazard_frame_updated_cox</span><span class="op">$</span><span class="va">AP_i</span><span class="op">==</span><span class="fl">13</span><span class="op">&amp;</span> <span class="va">hazard_frame_updated_cox</span><span class="op">$</span><span class="va">claim_type</span><span class="op">==</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S_i"</span>, <span class="st">"DP_rev_i"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">estimated_cox</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">estimated_cox</span><span class="op">)</span><span class="op">[</span>,<span class="va">model_label</span><span class="op">:=</span><span class="st">'COX'</span><span class="op">]</span></span>
<span><span class="va">estimated_nn</span> <span class="op">&lt;-</span> <span class="va">hazard_frame_updated_nn</span><span class="op">[</span><span class="va">hazard_frame_updated_nn</span><span class="op">$</span><span class="va">AP_i</span><span class="op">==</span><span class="fl">13</span><span class="op">&amp;</span> <span class="va">hazard_frame_updated_nn</span><span class="op">$</span><span class="va">claim_type</span><span class="op">==</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S_i"</span>, <span class="st">"DP_rev_i"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">estimated_nn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">estimated_nn</span><span class="op">)</span><span class="op">[</span>,<span class="va">model_label</span><span class="op">:=</span><span class="st">'NN'</span><span class="op">]</span></span>
<span><span class="va">estimated_xgb</span> <span class="op">&lt;-</span> <span class="va">hazard_frame_updated_xgb</span><span class="op">[</span><span class="va">hazard_frame_updated_xgb</span><span class="op">$</span><span class="va">AP_i</span><span class="op">==</span><span class="fl">13</span><span class="op">&amp;</span> <span class="va">hazard_frame_updated_xgb</span><span class="op">$</span><span class="va">claim_type</span><span class="op">==</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S_i"</span>, <span class="st">"DP_rev_i"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">estimated_xgb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">estimated_xgb</span><span class="op">)</span><span class="op">[</span>,<span class="va">model_label</span><span class="op">:=</span><span class="st">'XGB'</span><span class="op">]</span></span>
<span></span>
<span><span class="va">dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">estimated_cox</span>,<span class="va">estimated_nn</span>,<span class="va">estimated_xgb</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">dt</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">DP_rev_i</span>,y<span class="op">=</span><span class="va">S_i</span>, color<span class="op">=</span><span class="va">model_label</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="op">~</span><span class="va">model_label</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span>geom<span class="op">=</span><span class="st">'line'</span>, x<span class="op">=</span><span class="va">true_curve</span><span class="op">$</span><span class="va">DP_rev_i</span>,y<span class="op">=</span><span class="va">true_curve</span><span class="op">$</span><span class="va">S_i</span>, lty<span class="op">=</span><span class="fl">2</span>, linewidth<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>                     breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">440</span>,<span class="fl">940</span><span class="op">)</span>,</span>
<span>                     labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1440"</span>,<span class="st">"1000"</span>,<span class="st">"500"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>expand<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">.001</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="fu">latex2exp</span><span class="fu">::</span><span class="fu">TeX</span><span class="op">(</span><span class="st">"Development time"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Survival function"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Model"</span>,</span>
<span>                     values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#AAAABC"</span>, <span class="st">"#a71429"</span>, <span class="st">"#4169E1"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"none"</span>,</span>
<span>        text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>,</span>
<span>        axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, vjust <span class="op">=</span> <span class="fl">0.5</span>, hjust<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="figure-5">Figure 5<a class="anchor" aria-label="anchor" href="#figure-5"></a>
</h3>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_ap</span><span class="op">=</span><span class="fl">691</span></span>
<span><span class="va">period_function</span> <span class="op">&lt;-</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span>  <span class="st">"</span></span>
<span><span class="st">  Add monthly seasonal effect starting from daily input.</span></span>
<span><span class="st"></span></span>
<span><span class="st">  "</span></span>
<span></span>
<span>  <span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="op">(</span><span class="va">x</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">/</span><span class="fl">30</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="op">(</span><span class="va">tmp</span><span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span><span class="fl">12</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.3</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="op">(</span><span class="va">tmp</span><span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span><span class="fl">12</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">6</span>,<span class="fl">7</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fl">0.4</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="op">(</span><span class="va">tmp</span><span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span><span class="fl">12</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">8</span>,<span class="fl">9</span>,<span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.7</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="op">(</span><span class="va">tmp</span><span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span><span class="fl">12</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">11</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span> <span class="co">#0 instead of 12</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fl">0.1</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">beta</span><span class="op">=</span><span class="fl">2</span><span class="op">*</span><span class="fl">30</span></span>
<span><span class="va">lambda</span><span class="op">=</span><span class="fl">0.1</span> <span class="co">#1</span></span>
<span><span class="va">k</span><span class="op">=</span><span class="fl">1</span></span>
<span><span class="va">b</span><span class="op">=</span><span class="fl">1440</span></span>
<span><span class="va">alpha</span><span class="op">=</span><span class="fl">0.5</span></span>
<span><span class="va">beta0</span> <span class="op">=</span> <span class="fl">1.15129</span></span>
<span><span class="va">beta1</span> <span class="op">=</span> <span class="fl">1.95601</span> <span class="op">+</span><span class="fu">period_function</span><span class="op">(</span><span class="va">my_ap</span><span class="op">)</span></span>
<span></span>
<span><span class="va">F_correct_s0</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">alpha</span>, <span class="va">beta</span>, <span class="va">lambda</span>, <span class="va">k</span>,<span class="va">b</span>,<span class="va">beta_coef</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co">#nu/xi*(t/xi)^(nu-1)</span></span>
<span>  <span class="co">#exp(-(t/xi)^nu)/(1-exp(-(t/xi)^nu)*</span></span>
<span>  <span class="co">#nu/xi*(t/xi)^(nu-1)*exp(beta1)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">beta</span><span class="op">^</span><span class="va">alpha</span> <span class="op">*</span><span class="op">(</span><span class="va">lambda</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">beta_coef</span><span class="op">)</span><span class="op">^</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="va">alpha</span><span class="op">*</span><span class="va">k</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span><span class="op">^</span><span class="op">(</span><span class="va">alpha</span><span class="op">*</span><span class="va">k</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="va">t</span><span class="op">^</span><span class="op">(</span><span class="op">-</span><span class="va">alpha</span><span class="op">*</span><span class="va">k</span><span class="op">)</span><span class="op">-</span><span class="va">b</span><span class="op">^</span><span class="op">(</span><span class="op">-</span><span class="va">alpha</span><span class="op">*</span><span class="va">k</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">c_correct_grouped</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="va">b</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">t</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">i</span>,<span class="va">i</span><span class="op">+</span><span class="fl">1</span>, by<span class="op">=</span><span class="fl">0.001</span><span class="op">)</span></span>
<span>  <span class="va">n_t</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span></span>
<span>  <span class="va">c_correct_grouped</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fu">F_correct_s0</span><span class="op">(</span><span class="va">t</span>, <span class="va">alpha</span>,<span class="va">beta</span>,<span class="va">lambda</span>,<span class="va">k</span>,<span class="va">b</span>, <span class="va">beta0</span><span class="op">)</span> <span class="op">)</span><span class="op">/</span><span class="va">n_t</span></span>
<span><span class="op">}</span></span>
<span><span class="va">c_correct_grouped</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">c_correct_grouped</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">b</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">c_correct_grouped1</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="va">b</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">t</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">i</span>,<span class="va">i</span><span class="op">+</span><span class="fl">1</span>, by<span class="op">=</span><span class="fl">0.001</span><span class="op">)</span></span>
<span>  <span class="va">n_t</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span></span>
<span>  <span class="va">c_correct_grouped1</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fu">F_correct_s0</span><span class="op">(</span><span class="va">t</span>, <span class="va">alpha</span>,<span class="va">beta</span>,<span class="va">lambda</span>,<span class="va">k</span>,<span class="va">b</span>, <span class="va">beta1</span><span class="op">)</span> <span class="op">)</span><span class="op">/</span><span class="va">n_t</span></span>
<span><span class="op">}</span></span>
<span><span class="va">c_correct_grouped1</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">c_correct_grouped1</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">b</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">true_curve</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span><span class="st">'DP_rev_i'</span><span class="op">=</span><span class="op">(</span><span class="va">b</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="op">(</span><span class="va">b</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>,by<span class="op">=</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>                         <span class="st">'S_i'</span><span class="op">=</span><span class="fl">1</span><span class="op">-</span><span class="op">(</span><span class="va">c_correct_grouped1</span><span class="op">)</span>,</span>
<span>                         <span class="st">'model_label'</span><span class="op">=</span><span class="st">'TRUE'</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">input_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/data_generator.html">data_generator</a></span><span class="op">(</span>random_seed <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                             scenario<span class="op">=</span><span class="fl">3</span>,</span>
<span>                             time_unit <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">360</span>,</span>
<span>                             years <span class="op">=</span> <span class="fl">4</span>,</span>
<span>                             period_exposure <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">individual_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/IndividualDataPP.html">IndividualDataPP</a></span><span class="op">(</span><span class="va">input_data</span>,</span>
<span>                                  id<span class="op">=</span><span class="st">"claim_number"</span>,</span>
<span>                                  continuous_features<span class="op">=</span><span class="st">"AP_i"</span>,</span>
<span>                                  categorical_features<span class="op">=</span><span class="st">"claim_type"</span>,</span>
<span>                                  accident_period<span class="op">=</span><span class="st">"AP"</span>,</span>
<span>                                  calendar_period<span class="op">=</span><span class="st">"RP"</span>,</span>
<span>                                  input_time_granularity <span class="op">=</span> <span class="st">"days"</span>,</span>
<span>                                  output_time_granularity <span class="op">=</span> <span class="st">"quarters"</span>,</span>
<span>                                  years<span class="op">=</span><span class="fl">4</span>,</span>
<span>                                  continuous_features_spline<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>                                  calendar_period_extrapolation<span class="op">=</span><span class="cn">F</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hparameters.xgb.31</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>params<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>booster<span class="op">=</span><span class="st">"gbtree"</span>,</span>
<span>                                    eta<span class="op">=</span><span class="fl">0.1801517</span>,</span>
<span>                                    subsample<span class="op">=</span><span class="fl">0.8768306</span>,</span>
<span>                                    alpha<span class="op">=</span><span class="fl">0.6620562</span>,</span>
<span>                                    lambda<span class="op">=</span><span class="fl">1.379897</span>,</span>
<span>                                    min_child_weight<span class="op">=</span><span class="fl">15.61339</span>,</span>
<span>                                    max_depth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>                        print_every_n <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                        nrounds<span class="op">=</span><span class="fl">3000</span>,</span>
<span>                        verbose<span class="op">=</span><span class="cn">F</span>,</span>
<span>                        early_stopping_rounds <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hparameters.nn.31</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>num_layers<span class="op">=</span><span class="fl">2</span>,</span>
<span>                         early_stopping <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                         patience <span class="op">=</span> <span class="fl">350</span>,</span>
<span>                         verbose<span class="op">=</span><span class="cn">F</span>,</span>
<span>                         network_structure <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                         num_nodes <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                         activation <span class="op">=</span> <span class="st">"LeakyReLU"</span>,</span>
<span>                         optim<span class="op">=</span> <span class="st">"Adam"</span>,</span>
<span>                         lr <span class="op">=</span> <span class="fl">0.3542422</span>,</span>
<span>                         xi<span class="op">=</span> <span class="fl">0.1803953</span>,</span>
<span>                         epsilon <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                         batch_size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fl">5000</span><span class="op">)</span>,</span>
<span>                         epochs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fl">5500</span><span class="op">)</span>,</span>
<span>                         num_workers<span class="op">=</span><span class="fl">0</span>,</span>
<span>                         tie<span class="op">=</span><span class="st">'Efron'</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">resurv.fit.cox.31</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ReSurv.html">ReSurv</a></span><span class="op">(</span><span class="va">individual_data</span>,</span>
<span>                             hazard_model <span class="op">=</span> <span class="st">"COX"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">resurv.fit.nn.31</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ReSurv.html">ReSurv</a></span><span class="op">(</span><span class="va">individual_data</span>,</span>
<span>                             hazard_model <span class="op">=</span> <span class="st">"NN"</span>,</span>
<span>                             hparameters <span class="op">=</span> <span class="va">hparameters.nn.31</span><span class="op">)</span></span>
<span></span>
<span><span class="va">resurv.fit.xgb.31</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ReSurv.html">ReSurv</a></span><span class="op">(</span><span class="va">individual_data</span>,</span>
<span>                             hazard_model <span class="op">=</span> <span class="st">"XGB"</span>,</span>
<span>                             hparameters <span class="op">=</span> <span class="va">hparameters.xgb.31</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hazard_frame_updated_cox</span> <span class="op">&lt;-</span> <span class="va">resurv.fit.cox.31</span><span class="op">$</span><span class="va">hazard_frame</span></span>
<span></span>
<span><span class="va">hazard_frame_updated_nn</span> <span class="op">&lt;-</span> <span class="va">resurv.fit.nn.31</span><span class="op">$</span><span class="va">hazard_frame</span></span>
<span></span>
<span><span class="va">hazard_frame_updated_xgb</span> <span class="op">&lt;-</span> <span class="va">resurv.fit.xgb.31</span><span class="op">$</span><span class="va">hazard_frame</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="va">estimated_cox</span> <span class="op">&lt;-</span> <span class="va">hazard_frame_updated_cox</span><span class="op">[</span><span class="va">hazard_frame_updated_cox</span><span class="op">$</span><span class="va">AP_i</span><span class="op">==</span><span class="va">my_ap</span><span class="op">&amp;</span> <span class="va">hazard_frame_updated_cox</span><span class="op">$</span><span class="va">claim_type</span><span class="op">==</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S_i"</span>, <span class="st">"DP_rev_i"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">estimated_cox</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">estimated_cox</span><span class="op">)</span><span class="op">[</span>,<span class="va">model_label</span><span class="op">:=</span><span class="st">'COX'</span><span class="op">]</span></span>
<span><span class="va">estimated_nn</span> <span class="op">&lt;-</span> <span class="va">hazard_frame_updated_nn</span><span class="op">[</span><span class="va">hazard_frame_updated_nn</span><span class="op">$</span><span class="va">AP_i</span><span class="op">==</span><span class="va">my_ap</span><span class="op">&amp;</span> <span class="va">hazard_frame_updated_nn</span><span class="op">$</span><span class="va">claim_type</span><span class="op">==</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S_i"</span>, <span class="st">"DP_rev_i"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">estimated_nn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">estimated_nn</span><span class="op">)</span><span class="op">[</span>,<span class="va">model_label</span><span class="op">:=</span><span class="st">'NN'</span><span class="op">]</span></span>
<span><span class="va">estimated_xgb</span> <span class="op">&lt;-</span> <span class="va">hazard_frame_updated_xgb</span><span class="op">[</span><span class="va">hazard_frame_updated_xgb</span><span class="op">$</span><span class="va">AP_i</span><span class="op">==</span><span class="va">my_ap</span><span class="op">&amp;</span> <span class="va">hazard_frame_updated_xgb</span><span class="op">$</span><span class="va">claim_type</span><span class="op">==</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S_i"</span>, <span class="st">"DP_rev_i"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">estimated_xgb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">estimated_xgb</span><span class="op">)</span><span class="op">[</span>,<span class="va">model_label</span><span class="op">:=</span><span class="st">'XGB'</span><span class="op">]</span></span>
<span></span>
<span><span class="va">dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">estimated_cox</span>,<span class="va">estimated_nn</span>,<span class="va">estimated_xgb</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">dt</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">DP_rev_i</span>,y<span class="op">=</span><span class="va">S_i</span>, color<span class="op">=</span><span class="va">model_label</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="op">~</span><span class="va">model_label</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span>geom<span class="op">=</span><span class="st">'line'</span>, x<span class="op">=</span><span class="va">true_curve</span><span class="op">$</span><span class="va">DP_rev_i</span>,y<span class="op">=</span><span class="va">true_curve</span><span class="op">$</span><span class="va">S_i</span>, lty<span class="op">=</span><span class="fl">2</span>, linewidth<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>                     breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">440</span>,<span class="fl">940</span><span class="op">)</span>,</span>
<span>                     labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1440"</span>,<span class="st">"1000"</span>,<span class="st">"500"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>expand<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">.001</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Development time"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Survival function"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Model"</span>,</span>
<span>                     values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#AAAABC"</span>, <span class="st">"#a71429"</span>, <span class="st">"#4169E1"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"none"</span>,</span>
<span>        text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>,</span>
<span>        axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, vjust <span class="op">=</span> <span class="fl">0.5</span>, hjust<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="fitting-and-scoring">Fitting and scoring<a class="anchor" aria-label="anchor" href="#fitting-and-scoring"></a>
</h2>
<div class="section level3">
<h3 id="fitting">Fitting<a class="anchor" aria-label="anchor" href="#fitting"></a>
</h3>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">seed</span> <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="va">scenario</span> <span class="op">=</span> <span class="fl">0</span></span>
<span></span>
<span><span class="va">input_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/data_generator.html">data_generator</a></span><span class="op">(</span>random_seed <span class="op">=</span> <span class="va">seed</span>,</span>
<span>                             scenario<span class="op">=</span><span class="va">scenario</span>,</span>
<span>                             time_unit <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">360</span>,</span>
<span>                             years <span class="op">=</span> <span class="fl">4</span>,</span>
<span>                             period_exposure <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span>
<span></span>
<span><span class="va">individual_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/IndividualDataPP.html">IndividualDataPP</a></span><span class="op">(</span><span class="va">input_data</span>,</span>
<span>                                  id<span class="op">=</span><span class="st">"claim_number"</span>,</span>
<span>                                  continuous_features<span class="op">=</span><span class="st">"AP_i"</span>,</span>
<span>                                  categorical_features<span class="op">=</span><span class="st">"claim_type"</span>,</span>
<span>                                  accident_period<span class="op">=</span><span class="st">"AP"</span>,</span>
<span>                                  calendar_period<span class="op">=</span><span class="st">"RP"</span>,</span>
<span>                                  input_time_granularity <span class="op">=</span> <span class="st">"days"</span>,</span>
<span>                                  output_time_granularity <span class="op">=</span> <span class="st">"quarters"</span>,</span>
<span>                                  years<span class="op">=</span><span class="fl">4</span>,</span>
<span>                                  continuous_features_spline<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>                                  calendar_period_extrapolation<span class="op">=</span><span class="cn">F</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="scoring">Scoring<a class="anchor" aria-label="anchor" href="#scoring"></a>
</h3>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">start</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">resurv.fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ReSurv.html">ReSurv</a></span><span class="op">(</span><span class="va">individual_data</span>,</span>
<span>                       hazard_model <span class="op">=</span> <span class="st">"COX"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">resurv.fit.predict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">resurv.fit</span>,</span>
<span>                                grouping_method <span class="op">=</span> <span class="st">"probability"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="va">start</span></span>
<span></span>
<span></span>
<span><span class="va">max_dp_i</span> <span class="op">&lt;-</span><span class="fl">1440</span></span>
<span></span>
<span><span class="co"># Compute the continuously Ranked Probability Score (CRPS) ----</span></span>
<span></span>
<span><span class="va">crps_dt</span> <span class="op">&lt;-</span> <span class="fu">ReSurv</span><span class="fu">::</span><span class="fu"><a href="../reference/survival_crps.html">survival_crps</a></span><span class="op">(</span><span class="va">resurv.fit</span><span class="op">)</span></span>
<span><span class="va">crps_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">crps_dt</span><span class="op">$</span><span class="va">crps</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute the ARE tot ----</span></span>
<span></span>
<span><span class="va">conversion_factor</span> <span class="op">&lt;-</span> <span class="va">resurv.fit</span><span class="op">$</span><span class="va">IndividualDataPP</span><span class="op">$</span><span class="va">conversion_factor</span></span>
<span></span>
<span><span class="va">true_output</span> <span class="op">&lt;-</span> <span class="va">resurv.fit</span><span class="op">$</span><span class="va">IndividualDataPP</span><span class="op">$</span><span class="va">full.data</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    DP_rev_o <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">max_dp_i</span><span class="op">*</span><span class="va">conversion_factor</span><span class="op">)</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">DP_i</span><span class="op">*</span><span class="va">conversion_factor</span><span class="op">+</span><span class="op">(</span><span class="op">(</span><span class="va">AP_i</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">conversion_factor</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="va">conversion_factor</span><span class="op">)</span> <span class="op">+</span><span class="fl">1</span>,</span>
<span>    AP_o <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">AP_i</span><span class="op">*</span><span class="va">conversion_factor</span><span class="op">)</span>,</span>
<span>    TR_o<span class="op">=</span> <span class="va">AP_o</span><span class="op">-</span><span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">DP_rev_o</span> <span class="op">&lt;=</span><span class="va">TR_o</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">claim_type</span>, <span class="va">AP_o</span>, <span class="va">DP_rev_o</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>claim_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">claim_type</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarize</span><span class="op">(</span>I<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">I</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">DP_rev_o</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span> <span class="co">#we cant have =0, because corresponds to half a parallelogram.</span></span>
<span></span>
<span><span class="co">#Total output</span></span>
<span><span class="va">score_total</span><span class="op">&lt;-</span> <span class="va">resurv.fit.predict</span><span class="op">$</span><span class="va">hazard_frame_output</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"claim_type"</span>,<span class="st">"AP_o"</span>, <span class="st">"DP_rev_o"</span>, <span class="st">"I_expected"</span><span class="op">)</span><span class="op">]</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">inner_join</span><span class="op">(</span><span class="va">true_output</span>, by <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"claim_type"</span>,<span class="st">"AP_o"</span>, <span class="st">"DP_rev_o"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>ave <span class="op">=</span> <span class="va">I</span><span class="op">-</span><span class="va">I_expected</span>,</span>
<span>         abs_ave <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">ave</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">AP_o</span>, <span class="va">DP_rev_o</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">reframe</span><span class="op">(</span>abs_ave<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">ave</span><span class="op">)</span><span class="op">)</span>,</span>
<span>          I<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">I</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">are_tot</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">score_total</span><span class="op">$</span><span class="va">abs_ave</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">score_total</span><span class="op">$</span><span class="va">I</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute the ARE cal ----</span></span>
<span></span>
<span><span class="co"># Quarterly ----</span></span>
<span></span>
<span><span class="va">dfs_output</span> <span class="op">&lt;-</span> <span class="va">resurv.fit.predict</span><span class="op">$</span><span class="va">hazard_frame_output</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">AP_o</span>, <span class="va">claim_type</span>, <span class="va">DP_rev_o</span>, <span class="va">df_o</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>DP_rev_o <span class="op">=</span> <span class="va">DP_rev_o</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">distinct</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">score_diagonal</span> <span class="op">&lt;-</span> <span class="va">resurv.fit</span><span class="op">$</span><span class="va">IndividualDataPP</span><span class="op">$</span><span class="va">full.data</span>  <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    DP_rev_o <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">max_dp_i</span><span class="op">*</span><span class="va">conversion_factor</span><span class="op">)</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">DP_i</span><span class="op">*</span><span class="va">conversion_factor</span><span class="op">+</span><span class="op">(</span><span class="op">(</span><span class="va">AP_i</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">conversion_factor</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="va">conversion_factor</span><span class="op">)</span> <span class="op">+</span><span class="fl">1</span>,</span>
<span>    AP_o <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">AP_i</span><span class="op">*</span><span class="va">conversion_factor</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">claim_type</span>, <span class="va">AP_o</span>, <span class="va">DP_rev_o</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>claim_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">claim_type</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarize</span><span class="op">(</span>I<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">I</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">claim_type</span>, <span class="va">AP_o</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">DP_rev_o</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>I_cum<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">I</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>I_cum_lag <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">I_cum</span>, default <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="va">dfs_output</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AP_o"</span>, <span class="st">"claim_type"</span>, <span class="st">"DP_rev_o"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>I_cum_hat <span class="op">=</span>  <span class="va">I_cum_lag</span> <span class="op">*</span> <span class="va">df_o</span>,</span>
<span>         RP_o <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">DP_rev_o</span><span class="op">)</span><span class="op">-</span><span class="va">DP_rev_o</span> <span class="op">+</span> <span class="va">AP_o</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">inner_join</span><span class="op">(</span><span class="va">true_output</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AP_o"</span>, <span class="st">"DP_rev_o"</span><span class="op">)</span><span class="op">]</span> <span class="op">%&gt;%</span>  <span class="fu">distinct</span><span class="op">(</span><span class="op">)</span></span>
<span>             , by <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AP_o"</span>, <span class="st">"DP_rev_o"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">AP_o</span>,<span class="va">DP_rev_o</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">reframe</span><span class="op">(</span>abs_ave2_diag <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">I_cum_hat</span><span class="op">)</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">I_cum</span><span class="op">)</span><span class="op">)</span>,</span>
<span>          I<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">I</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">are_cal_q</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">score_diagonal</span><span class="op">$</span><span class="va">abs_ave2_diag</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">score_diagonal</span><span class="op">$</span><span class="va">I</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Yearly ----</span></span>
<span></span>
<span><span class="va">individual_data2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/IndividualDataPP.html">IndividualDataPP</a></span><span class="op">(</span><span class="va">input_data</span>,</span>
<span>                                   id<span class="op">=</span><span class="st">"claim_number"</span>,</span>
<span>                                   continuous_features<span class="op">=</span><span class="st">"AP_i"</span>,</span>
<span>                                   categorical_features<span class="op">=</span><span class="st">"claim_type"</span>,</span>
<span>                                   accident_period<span class="op">=</span><span class="st">"AP"</span>,</span>
<span>                                   calendar_period<span class="op">=</span><span class="st">"RP"</span>,</span>
<span>                                   input_time_granularity <span class="op">=</span> <span class="st">"days"</span>,</span>
<span>                                   output_time_granularity <span class="op">=</span> <span class="st">"years"</span>,</span>
<span>                                   years<span class="op">=</span><span class="fl">4</span>,</span>
<span>                                   continuous_features_spline<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>                                   calendar_period_extrapolation<span class="op">=</span><span class="cn">F</span><span class="op">)</span></span>
<span></span>
<span><span class="va">resurv.predict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">resurv.fit</span>,</span>
<span>                          newdata<span class="op">=</span><span class="va">individual_data2</span>,</span>
<span>                          grouping_method <span class="op">=</span> <span class="st">"probability"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">conversion_factor</span> <span class="op">&lt;-</span> <span class="va">individual_data2</span><span class="op">$</span><span class="va">conversion_factor</span></span>
<span></span>
<span></span>
<span><span class="va">max_dp_i</span> <span class="op">&lt;-</span><span class="fl">1440</span></span>
<span></span>
<span></span>
<span><span class="va">true_output</span> <span class="op">&lt;-</span> <span class="va">individual_data2</span><span class="op">$</span><span class="va">full.data</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    DP_rev_o <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">max_dp_i</span><span class="op">*</span><span class="va">conversion_factor</span><span class="op">)</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">DP_i</span><span class="op">*</span><span class="va">conversion_factor</span><span class="op">+</span><span class="op">(</span><span class="op">(</span><span class="va">AP_i</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">conversion_factor</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="va">conversion_factor</span><span class="op">)</span> <span class="op">+</span><span class="fl">1</span>,</span>
<span>    AP_o <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">AP_i</span><span class="op">*</span><span class="va">conversion_factor</span><span class="op">)</span>,</span>
<span>    TR_o<span class="op">=</span> <span class="va">AP_o</span><span class="op">-</span><span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">DP_rev_o</span> <span class="op">&lt;=</span><span class="va">TR_o</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">claim_type</span>, <span class="va">AP_o</span>, <span class="va">DP_rev_o</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>claim_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">claim_type</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarize</span><span class="op">(</span>I<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">I</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">DP_rev_o</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span> <span class="co">#we cant have =0, because corresponds to half a parallelogram.</span></span>
<span></span>
<span><span class="va">dfs_output</span> <span class="op">&lt;-</span> <span class="va">resurv.predict</span><span class="op">$</span><span class="va">hazard_frame_output</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">AP_o</span>, <span class="va">claim_type</span>, <span class="va">DP_rev_o</span>, <span class="va">df_o</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>DP_rev_o <span class="op">=</span> <span class="va">DP_rev_o</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">distinct</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Cashflow on output scale.Etc quarterly cashflow development</span></span>
<span><span class="va">score_diagonal_yearly</span> <span class="op">&lt;-</span> <span class="va">individual_data2</span><span class="op">$</span><span class="va">full.data</span>  <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    DP_rev_o <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">max_dp_i</span><span class="op">*</span><span class="va">conversion_factor</span><span class="op">)</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">DP_i</span><span class="op">*</span><span class="va">conversion_factor</span><span class="op">+</span><span class="op">(</span><span class="op">(</span><span class="va">AP_i</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">conversion_factor</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="va">conversion_factor</span><span class="op">)</span> <span class="op">+</span><span class="fl">1</span>,</span>
<span>    AP_o <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">AP_i</span><span class="op">*</span><span class="va">conversion_factor</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">claim_type</span>, <span class="va">AP_o</span>, <span class="va">DP_rev_o</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>claim_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">claim_type</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarize</span><span class="op">(</span>I<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">I</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">claim_type</span>, <span class="va">AP_o</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">DP_rev_o</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>I_cum<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">I</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>I_cum_lag <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">I_cum</span>, default <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="va">dfs_output</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AP_o"</span>, <span class="st">"claim_type"</span>, <span class="st">"DP_rev_o"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>I_cum_hat <span class="op">=</span>  <span class="va">I_cum_lag</span> <span class="op">*</span> <span class="va">df_o</span>,</span>
<span>         RP_o <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">DP_rev_o</span><span class="op">)</span><span class="op">-</span><span class="va">DP_rev_o</span> <span class="op">+</span> <span class="va">AP_o</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">inner_join</span><span class="op">(</span><span class="va">true_output</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AP_o"</span>, <span class="st">"DP_rev_o"</span><span class="op">)</span><span class="op">]</span> <span class="op">%&gt;%</span>  <span class="fu">distinct</span><span class="op">(</span><span class="op">)</span></span>
<span>             , by <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AP_o"</span>, <span class="st">"DP_rev_o"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">AP_o</span>,<span class="va">DP_rev_o</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">reframe</span><span class="op">(</span>abs_ave2_diag <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">I_cum_hat</span><span class="op">)</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">I_cum</span><span class="op">)</span><span class="op">)</span>,</span>
<span>          I<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">I</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">are_cal_y</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">score_diagonal_yearly</span><span class="op">$</span><span class="va">abs_ave2_diag</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">score_diagonal_yearly</span><span class="op">$</span><span class="va">I</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Emil Hofman, Gabriele Pittarello, Munir Hiabu.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
